// @bun
var b$=Object.create;var{defineProperty:T1,getPrototypeOf:H$,getOwnPropertyNames:x$}=Object;var g$=Object.prototype.hasOwnProperty;var I0=($,W,J)=>{J=$!=null?b$(H$($)):{};const X=W||!$||!$.__esModule?T1(J,"default",{value:$,enumerable:!0}):J;for(let Z of x$($))if(!g$.call(X,Z))T1(X,Z,{get:()=>$[Z],enumerable:!0});return X};var _0=($,W)=>()=>(W||$((W={exports:{}}).exports,W),W.exports);var E1=_0((k9,X1)=>{var O0=function(){},v$=function($,W,J){this.fn=$,this.context=W,this.once=J||!1},R1=function($,W,J,X,Z){if(typeof J!=="function")throw new TypeError("The listener must be a function");var Q=new v$(J,X||$,Z),B=y?y+W:W;if(!$._events[B])$._events[B]=Q,$._eventsCount++;else if(!$._events[B].fn)$._events[B].push(Q);else $._events[B]=[$._events[B],Q];return $},k0=function($,W){if(--$._eventsCount===0)$._events=new O0;else delete $._events[W]},g=function(){this._events=new O0,this._eventsCount=0},y$=Object.prototype.hasOwnProperty,y="~";if(Object.create){if(O0.prototype=Object.create(null),!new O0().__proto__)y=!1}g.prototype.eventNames=function $(){var W=[],J,X;if(this._eventsCount===0)return W;for(X in J=this._events)if(y$.call(J,X))W.push(y?X.slice(1):X);if(Object.getOwnPropertySymbols)return W.concat(Object.getOwnPropertySymbols(J));return W};g.prototype.listeners=function $(W){var J=y?y+W:W,X=this._events[J];if(!X)return[];if(X.fn)return[X.fn];for(var Z=0,Q=X.length,B=new Array(Q);Z<Q;Z++)B[Z]=X[Z].fn;return B};g.prototype.listenerCount=function $(W){var J=y?y+W:W,X=this._events[J];if(!X)return 0;if(X.fn)return 1;return X.length};g.prototype.emit=function $(W,J,X,Z,Q,B){var Y=y?y+W:W;if(!this._events[Y])return!1;var G=this._events[Y],K=arguments.length,_,F;if(G.fn){if(G.once)this.removeListener(W,G.fn,void 0,!0);switch(K){case 1:return G.fn.call(G.context),!0;case 2:return G.fn.call(G.context,J),!0;case 3:return G.fn.call(G.context,J,X),!0;case 4:return G.fn.call(G.context,J,X,Z),!0;case 5:return G.fn.call(G.context,J,X,Z,Q),!0;case 6:return G.fn.call(G.context,J,X,Z,Q,B),!0}for(F=1,_=new Array(K-1);F<K;F++)_[F-1]=arguments[F];G.fn.apply(G.context,_)}else{var z=G.length,A;for(F=0;F<z;F++){if(G[F].once)this.removeListener(W,G[F].fn,void 0,!0);switch(K){case 1:G[F].fn.call(G[F].context);break;case 2:G[F].fn.call(G[F].context,J);break;case 3:G[F].fn.call(G[F].context,J,X);break;case 4:G[F].fn.call(G[F].context,J,X,Z);break;default:if(!_)for(A=1,_=new Array(K-1);A<K;A++)_[A-1]=arguments[A];G[F].fn.apply(G[F].context,_)}}}return!0};g.prototype.on=function $(W,J,X){return R1(this,W,J,X,!1)};g.prototype.once=function $(W,J,X){return R1(this,W,J,X,!0)};g.prototype.removeListener=function $(W,J,X,Z){var Q=y?y+W:W;if(!this._events[Q])return this;if(!J)return k0(this,Q),this;var B=this._events[Q];if(B.fn){if(B.fn===J&&(!Z||B.once)&&(!X||B.context===X))k0(this,Q)}else{for(var Y=0,G=[],K=B.length;Y<K;Y++)if(B[Y].fn!==J||Z&&!B[Y].once||X&&B[Y].context!==X)G.push(B[Y]);if(G.length)this._events[Q]=G.length===1?G[0]:G;else k0(this,Q)}return this};g.prototype.removeAllListeners=function $(W){var J;if(W){if(J=y?y+W:W,this._events[J])k0(this,J)}else this._events=new O0,this._eventsCount=0;return this};g.prototype.off=g.prototype.removeListener;g.prototype.addListener=g.prototype.on;g.prefixed=y;g.EventEmitter=g;if(typeof X1!=="undefined")X1.exports=g});var d0=_0((d9,d1)=>{var o$=function($){var W=$.indexOf("%");if(W===-1)return $;var J=$.length,X="",Z=0,Q=0,B=W,Y=u1;while(W>-1&&W<J){var G=m1($[W+1],4),K=m1($[W+2],0),_=G|K,F=Y1[_];if(Y=Y1[256+Y+F],Q=Q<<6|_&Y1[364+F],Y===u1)X+=$.slice(Z,B),X+=Q<=65535?String.fromCharCode(Q):String.fromCharCode(55232+(Q>>10),56320+(Q&1023)),Q=0,Z=W+3,W=B=$.indexOf("%",Z);else if(Y===r$)return null;else{if(W+=3,W<J&&$.charCodeAt(W)===37)continue;return null}}return X+$.slice(Z)},m1=function($,W){var J=a$[$];return J===void 0?255:J<<W},u1=12,r$=0,Y1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,127,63,63,63,0,31,15,15,15,7,7,7],a$={"0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"7":7,"8":8,"9":9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};d1.exports=o$});var Z$=_0((_6,X$)=>{var Y9=function($){const W=new J$;if(typeof $!=="string")return W;let J=$.length,X="",Z="",Q=-1,B=-1,Y=!1,G=!1,K=!1,_=!1,F=!1,z=0;for(let A=0;A<J+1;A++)if(z=A!==J?$.charCodeAt(A):38,z===38){if(F=B>Q,!F)B=A;if(X=$.slice(Q+1,B),F||X.length>0){if(K)X=X.replace(W$," ");if(Y)X=$$(X)||X;if(F){if(Z=$.slice(B+1,A),_)Z=Z.replace(W$," ");if(G)Z=$$(Z)||Z}const j=W[X];if(j===void 0)W[X]=Z;else if(j.pop)j.push(Z);else W[X]=[j,Z]}Z="",Q=A,B=A,Y=!1,G=!1,K=!1,_=!1}else if(z===61)if(B<=Q)B=A;else G=!0;else if(z===43)if(B>Q)_=!0;else K=!0;else if(z===37)if(B>Q)G=!0;else Y=!0;return W},$$=d0(),W$=/\+/g,J$=function(){};J$.prototype=Object.create(null);X$.exports=Y9});var B$=_0((F6,Q$)=>{var U9=function($){const W=$.length;if(W===0)return"";let J="",X=0,Z=0;$:for(;Z<W;Z++){let Q=$.charCodeAt(Z);while(Q<128){if(G9[Q]!==1){if(X<Z)J+=$.slice(X,Z);X=Z+1,J+=t[Q]}if(++Z===W)break $;Q=$.charCodeAt(Z)}if(X<Z)J+=$.slice(X,Z);if(Q<2048){X=Z+1,J+=t[192|Q>>6]+t[128|Q&63];continue}if(Q<55296||Q>=57344){X=Z+1,J+=t[224|Q>>12]+t[128|Q>>6&63]+t[128|Q&63];continue}if(++Z,Z>=W)throw new Error("URI malformed");const B=$.charCodeAt(Z)&1023;X=Z+1,Q=65536+((Q&1023)<<10|B),J+=t[240|Q>>18]+t[128|Q>>12&63]+t[128|Q>>6&63]+t[128|Q&63]}if(X===0)return $;if(X<W)return J+$.slice(X);return J},t=Array.from({length:256},($,W)=>"%"+((W<16?"0":"")+W.toString(16)).toUpperCase()),G9=new Int8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0]);Q$.exports={encodeString:U9}});var U$=_0((D6,G$)=>{var Y$=function($){const W=typeof $;if(W==="string")return j1($);else if(W==="bigint")return $.toString();else if(W==="boolean")return $?"true":"false";else if(W==="number"&&Number.isFinite($))return $<1000000000000000000000?""+$:j1(""+$);return""},K9=function($){let W="";if($===null||typeof $!=="object")return W;const J="&",X=Object.keys($),Z=X.length;let Q=0;for(let B=0;B<Z;B++){const Y=X[B],G=$[Y],K=j1(Y)+"=";if(B)W+=J;if(Array.isArray(G)){Q=G.length;for(let _=0;_<Q;_++){if(_)W+=J;W+=K,W+=Y$(G[_])}}else W+=K,W+=Y$(G)}return W},{encodeString:j1}=B$();G$.exports=K9});var N1=_0((z6,q0)=>{var K$=Z$(),_$=U$(),F$={parse:K$,stringify:_$};q0.exports=F$;q0.exports.default=F$;q0.exports.parse=K$;q0.exports.stringify=_$});var F0=($,W)=>({part:$,store:null,inert:W!==void 0?new Map(W.map((J)=>[J.part.charCodeAt(0),J])):null,params:null,wildcardStore:null}),q1=($,W)=>({...$,part:W}),L1=($)=>({paramName:$,store:null,inert:null});class X0{root={};history=[];static regex={static:/:.+?(?=\/|$)/,params:/:.+?(?=\/|$)/g};add($,W,J){let X;if(typeof W!="string")throw TypeError("Route path must be a string");W===""?W="/":W[0]!=="/"&&(W=`/${W}`),this.history.push([$,W,J]);let Z=W[W.length-1]==="*";Z&&(W=W.slice(0,-1));let Q=W.split(X0.regex.static),B=W.match(X0.regex.params)||[];Q[Q.length-1]===""&&Q.pop(),X=this.root[$]?this.root[$]:this.root[$]=F0("/");let Y=0;for(let G=0;G<Q.length;++G){let K=Q[G];if(G>0){let _=B[Y++].slice(1);if(X.params===null)X.params=L1(_);else if(X.params.paramName!==_)throw Error(`Cannot create route "${W}" with parameter "${_}" because a route already exists with a different parameter name ("${X.params.paramName}") in the same location`);let F=X.params;if(F.inert===null){X=F.inert=F0(K);continue}X=F.inert}for(let _=0;;){if(_===K.length){if(_<X.part.length){let F=q1(X,X.part.slice(_));Object.assign(X,F0(K,[F]))}break}if(_===X.part.length){if(X.inert===null)X.inert=new Map;else if(X.inert.has(K.charCodeAt(_))){X=X.inert.get(K.charCodeAt(_)),K=K.slice(_),_=0;continue}let F=F0(K.slice(_));X.inert.set(K.charCodeAt(_),F),X=F;break}if(K[_]!==X.part[_]){let F=q1(X,X.part.slice(_)),z=F0(K.slice(_));Object.assign(X,F0(X.part.slice(0,_),[F,z])),X=z;break}++_}}if(Y<B.length){let G=B[Y],K=G.slice(1);if(X.params===null)X.params=L1(K);else if(X.params.paramName!==K)throw Error(`Cannot create route "${W}" with parameter "${K}" because a route already exists with a different parameter name ("${X.params.paramName}") in the same location`);return X.params.store===null&&(X.params.store=J),X.params.store}return Z?(X.wildcardStore===null&&(X.wildcardStore=J),X.wildcardStore):(X.store===null&&(X.store=J),X.store)}find($,W){let J=this.root[$];return J?J1(W,W.length,J,0):null}}var J1=($,W,J,X)=>{let Z=J?.part,Q=X+Z.length;if(Z.length>1){if(Q>W)return null;if(Z.length<15){for(let B=1,Y=X+1;B<Z.length;++B,++Y)if(Z.charCodeAt(B)!==$.charCodeAt(Y))return null}else if($.substring(X,Q)!==Z)return null}if(Q===W)return J.store!==null?{store:J.store,params:{}}:J.wildcardStore!==null?{store:J.wildcardStore,params:{"*":""}}:null;if(J.inert!==null){let B=J.inert.get($.charCodeAt(Q));if(B!==void 0){let Y=J1($,W,B,Q);if(Y!==null)return Y}}if(J.params!==null){let B=J.params,Y=$.indexOf("/",Q);if(Y!==Q){if(Y===-1||Y>=W){if(B.store!==null){let G={};return G[B.paramName]=$.substring(Q,W),{store:B.store,params:G}}}else if(B.inert!==null){let G=J1($,W,B.inert,Y);if(G!==null)return G.params[B.paramName]=$.substring(Q,Y),G}}}return J.wildcardStore!==null?{store:J.wildcardStore,params:{"*":$.substring(Q,W)}}:null};var b1=I0(E1(),1);var H1=b1.default;var f0=()=>{let $;return[new Promise((J)=>{$=J}),$]},J0=()=>{const[$,W]=f0(),[J,X]=f0(),Z=[],Q=[];return{signal:$,consume:(B)=>{switch(B.type){case"begin":if(B.unit&&Z.length===0)for(let Y=0;Y<B.unit;Y++){const[G,K]=f0(),[_,F]=f0();Z.push(G),Q.push([(z)=>{K({children:[],end:_,name:z.name??"",skip:!1,time:z.time})},(z)=>{F(z)}])}W({children:Z,end:J,name:B.name??"",skip:!1,time:B.time});break;case"end":X(B.time);break}},consumeChild(B){switch(B.type){case"begin":if(!Q[0])return;const[Y]=Q[0];Y({children:[],end:J,name:B.name??"",skip:!1,time:B.time});break;case"end":const G=Q.shift();if(!G)return;G[1](B.time)}},resolve(){W({children:[],end:new Promise((B)=>B(0)),name:"",skip:!0,time:0});for(let[B,Y]of Q)B({children:[],end:new Promise((G)=>G(0)),name:"",skip:!0,time:0}),Y(0);X(0)}}},x1=($,W,J)=>{if(typeof J==="object")J=J.fn;return async function X(X){if(X.event!=="request"||X.type!=="begin")return;const Z=X.id,Q=$(),B=J0(),Y=J0(),G=J0(),K=J0(),_=J0(),F=J0(),z=J0(),A=J0();B.consume(X);const j=(V)=>{if(V.id===Z)switch(V.event){case"request":B.consume(V);break;case"request.unit":B.consumeChild(V);break;case"parse":Y.consume(V);break;case"parse.unit":Y.consumeChild(V);break;case"transform":G.consume(V);break;case"transform.unit":G.consumeChild(V);break;case"beforeHandle":K.consume(V);break;case"beforeHandle.unit":K.consumeChild(V);break;case"handle":_.consume(V);break;case"afterHandle":F.consume(V);break;case"afterHandle.unit":F.consumeChild(V);break;case"error":z.consume(V);break;case"error.unit":z.consumeChild(V);break;case"response":if(V.type==="begin")B.resolve(),Y.resolve(),G.resolve(),K.resolve(),_.resolve(),F.resolve(),z.resolve();else Q.off("event",j);A.consume(V);break;case"response.unit":A.consumeChild(V);break;case"exit":B.resolve(),Y.resolve(),G.resolve(),K.resolve(),_.resolve(),F.resolve(),z.resolve();break}};Q.on("event",j),await J({id:Z,context:X.ctx,set:X.ctx?.set,store:X.ctx?.store,time:X.time,request:B.signal,parse:Y.signal,transform:G.signal,beforeHandle:K.signal,handle:_.signal,afterHandle:F.signal,error:z.signal,response:A.signal}),Q.emit(`res${Z}.${W}`,void 0)}};var y1=($)=>{if($.startsWith("async"))$=$.slice(6);let W=-1;if($.charCodeAt(0)===40){if(W=$.indexOf(") => {\n"),W!==-1)return[$.slice(1,W),$.slice(W+5),{isArrowReturn:!1}];if(W=$.indexOf(") => "),W!==-1)return[$.slice(1,W),$.slice(W+5),{isArrowReturn:!0}]}if($.startsWith("function")){W=$.indexOf("(");const Z=$.indexOf(")");return[$.slice(W+1,Z),$.slice(Z+2),{isArrowReturn:!1}]}const J=$.indexOf("(");if(J!==-1){const[Z,Q]=$.split("\n",2),B=Z.lastIndexOf(")")+1;return[Z.slice(J,B),"{"+Q,{isArrowReturn:!1}]}const X=$.split("\n",2);return[X[0],X[1],{isArrowReturn:!1}]},v1=($)=>{const W=$.indexOf("{");if(W===-1)return[-1,0];let J=W+1,X=1;for(;J<$.length;J++){const Z=$.charCodeAt(J);if(Z===123)X++;else if(Z===125)X--;if(X===0)break}if(X!==0)return[0,$.length];return[W,J+1]},k$=($)=>{const W=$.lastIndexOf("}");if(W===-1)return[-1,0];let J=W-1,X=1;for(;J>=0;J--){const Z=$.charCodeAt(J);if(Z===125)X++;else if(Z===123)X--;if(X===0)break}if(X!==0)return[-1,0];return[J,W+1]},h0=($)=>{if($.charCodeAt(0)===40)$=$.slice(1,-1);if($.charCodeAt(0)===123)$=$.slice(2,-2);while(!0){const[W,J]=v1($);if(W===-1)break;$=$.slice(0,W-2)+$.slice(J+1)}return $.replace(/:/g,"").trim()},f$=($,W)=>{const J=h0($);if(!W.query&&J.includes("query"))W.query=!0;if(!W.headers&&J.includes("headers"))W.headers=!0;if(!W.body&&J.includes("body"))W.body=!0;if(!W.cookie&&J.includes("cookie"))W.cookie=!0;if(!W.set&&J.includes("set"))W.set=!0;return J},h$=($,W)=>{const J=h0($);if(!W.request&&J.includes("request"))W.request=!0;if(!W.parse&&J.includes("parse"))W.parse=!0;if(!W.transform&&J.includes("transform"))W.transform=!0;if(!W.handle&&J.includes("handle"))W.handle=!0;if(!W.beforeHandle&&J.includes("beforeHandle"))W.beforeHandle=!0;if(!W.afterHandle&&J.includes("afterHandle"))W.afterHandle=!0;if(!W.error&&J.includes("error"))W.error=!0;if(!W.context&&J.includes("context"))W.context=!0;if(!W.store&&J.includes("store"))W.store=!0;if(!W.set&&J.includes("set"))W.set=!0;return J},k1=($,W,J)=>{const X=W.indexOf($+"\n",J),Z=W.indexOf($+"\t",J),Q=W.indexOf($+",",J),B=W.indexOf($+";",J),Y=W.indexOf($+" ",J);return[X,Z,Q,B,Y].filter((G)=>G>0).sort((G,K)=>G-K)[0]||-1};var Z1=($,W,J=0)=>{if(J>5)return[];const X=[];let Z=W;while(!0){let Q=k1(" = "+$,Z);if(Q===-1){const G=Z.indexOf(" = "+$);if(G+3+$.length!==Z.length)break;Q=G}const B=Z.slice(0,Q);let Y=B.slice(B.lastIndexOf(" ")+1);if(Y==="}"){const[G,K]=k$(B);X.push(Z.slice(G,K)),Z=Z.slice(Q+3+$.length);continue}while(Y.charCodeAt(0)===44)Y=Y.slice(1);while(Y.charCodeAt(0)===9)Y=Y.slice(1);X.push(Y),Z=Z.slice(Q+3+$.length)}for(let Q of X){if(Q.charCodeAt(0)===123)continue;const B=Z1(Q,W);if(B.length>0)X.push(...B)}return X},f1=($)=>{if(!$)return;if(!$.includes(",")){if($.includes("..."))return $.slice($.indexOf("...")+3);return $}const J=$.indexOf("...");if(J===-1)return;return $.slice(J+3).trimEnd()},g1=($,W,J)=>{const X=(Z,Q)=>$.includes(Q+"."+Z)||$.includes(Q+'["'+Z+'"]')||$.includes(Q+"['"+Z+"']");for(let Z of W){if(!Z)continue;if(Z.charCodeAt(0)===123){if(Z=h0(Z),!J.query&&Z.includes("query"))J.query=!0;if(!J.headers&&Z.includes("headers"))J.headers=!0;if(!J.body&&Z.includes("body"))J.body=!0;if(!J.cookie&&Z.includes("cookie"))J.cookie=!0;if(!J.set&&Z.includes("set"))J.set=!0;continue}if($.includes("("+Z+")")){J.query=!0,J.headers=!0,J.body=!0,J.cookie=!0,J.set=!0,J.queries=[],J.unknownQueries=!0;break}if(!J.query&&X("query",Z))J.query=!0;if($.includes("return "+Z)||$.includes("return "+Z+".query"))J.query=!0,J.unknownQueries=!0,J.queries=[];if(!J.unknownQueries&&J.query){let Q=Z+".";if($.includes(Q+"query"))Q=Z+".query";while(!0){let B=$.indexOf(Q);if(B===-1&&$.indexOf(Z+"[")!==-1){J.queries=[],J.unknownQueries=!0;break}if(B!==-1){let Y=k1("",$,B+Q.length+1);if(Y===-1)Y=void 0;const G=B+Z.length+1;$=$.slice(B+Z.length+1);let K=$.slice(0,Y?Y-G:Y).trimEnd();while(B!==-1)if(B=K.indexOf("."),B!==-1)K=K.slice(B+1);if(K.charCodeAt(K.length-1)===59)K=K.slice(0,-1);if(K.charCodeAt(K.length-1)===44)K=K.slice(0,-1);if(K.charCodeAt(K.length-1)===93)K=K.slice(0,-1);if(K.charCodeAt(K.length-1)===41)K=K.slice(0,-1);if(K&&!J.queries.includes(K)){J.queries.push(K);continue}}break}}if(!J.headers&&X("headers",Z))J.headers=!0;if(!J.body&&X("body",Z))J.body=!0;if(!J.cookie&&X("cookie",Z))J.cookie=!0;if(!J.set&&X("set",Z))J.set=!0;if(J.query&&J.headers&&J.body&&J.cookie&&J.set)break}return W},u$=($)=>{while(!0){const W=$.indexOf("=");if(W===-1)break;const J=$.indexOf(",",W),X=$.indexOf("}",W),Z=[J,X].filter((Q)=>Q>0).sort((Q,B)=>Q-B)[0]||-1;if(Z===-1){$=$.slice(0,W);break}$=$.slice(0,W)+$.slice(Z)}return $.split(",").map((W)=>W.trim()).join(", ")},m$=($)=>{for(let W of $){if(W.charCodeAt(0)===123)return!1;if(W.indexOf("'")!==-1)return!1;if(W.indexOf('"')!==-1)return!1;if(W.indexOf("\n")!==-1)return!1;if(W.indexOf("\t")!==-1)return!1}return!0},d$=($,W,J)=>{const X=(Z,Q)=>$.includes(Z+"."+Q)||$.includes(Z+'["'+Q+'"]')||$.includes(Z+"['"+Q+"']");for(let Z of W){if(Z.charCodeAt(0)===123){if(Z=h0(Z),!J.request&&Z.includes("request"))J.request=!0;if(!J.parse&&Z.includes("parse"))J.parse=!0;if(!J.transform&&Z.includes("transform"))J.transform=!0;if(!J.handle&&Z.includes("handle"))J.handle=!0;if(!J.beforeHandle&&Z.includes("beforeHandle"))J.beforeHandle=!0;if(!J.afterHandle&&Z.includes("afterHandle"))J.afterHandle=!0;if(!J.error&&Z.includes("error"))J.error=!0;if(!J.context&&Z.includes("context"))J.context=!0;if(!J.store&&Z.includes("store"))J.store=!0;if(!J.set&&Z.includes("set"))J.set=!0;continue}if($.includes("("+Z+")")){J.request=!0,J.parse=!0,J.transform=!0,J.handle=!0,J.beforeHandle=!0,J.afterHandle=!0,J.error=!0,J.context=!0,J.store=!0,J.set=!0;break}if(!J.request&&X("request",Z))J.request=!0;if(!J.parse&&X("parse",Z))J.parse=!0;if(!J.transform&&X("transform",Z))J.transform=!0;if(!J.handle&&X("handle",Z))J.handle=!0;if(!J.beforeHandle&&X("beforeHandle",Z))J.beforeHandle=!0;if(!J.afterHandle&&X("afterHandle",Z))J.afterHandle=!0;if(!J.error&&X("error",Z))J.error=!0;if(!J.context&&X("context",Z))J.context=!0;if(!J.store&&X("store",Z))J.store=!0;if(!J.set&&X("set",Z))J.set=!0;if(J.request&&J.parse&&J.transform&&J.handle&&J.beforeHandle&&J.afterHandle&&J.error&&J.context&&J.store&&J.set)break}return W},u0=($,W={queries:[],query:!1,headers:!1,body:!1,cookie:!1,set:!1,unknownQueries:!1})=>{const J=[];if($.handler&&typeof $.handler==="function")J.push($.handler);if($.beforeHandle?.length)J.push(...$.beforeHandle);if($.parse?.length)J.push(...$.parse);if($.error?.length)J.push(...$.error);if($.transform?.length)J.push(...$.transform);if($.afterHandle?.length)J.push(...$.afterHandle);if($.mapResponse?.length)J.push(...$.mapResponse);if($.request?.length)J.push(...$.request);if($.onResponse?.length)J.push(...$.onResponse);for(let X of J){if(!X)continue;const Z="fn"in X?X.fn:X,[Q,B,{isArrowReturn:Y}]=y1(Z.toString()),G=f$(Q,W),K=f1(G);if(Y&&(B==="query"||G&&B.startsWith(G+".query")))W.query=!0,W.unknownQueries=!0,W.queries=[];if(K){const F=Z1(K,B);F.splice(0,-1,K),g1(B,F,W)}const _=G||K;if(_&&B.includes("return "+_+".query"))W.query=!0,W.unknownQueries=!0,W.queries=[];if(W.query){g1(B,["query"],W);const F=Q.indexOf("query: {");if(F!==-1){const z=Q.slice(F+7),[A,j]=v1(z),V=u$(z.slice(A,j));for(let U of V.slice(1,-1).split(",")){const D=U.indexOf(":");if(D!==-1)U=U.slice(0,D);if(U=U.trim(),U&&!W.queries.includes(U))W.queries.push(U.trim())}}}if(W.query&&W.headers&&W.body&&W.cookie&&W.set)break}if(!m$(W.queries))W.unknownQueries=!0,W.queries=[];return W},h1=($,W={request:!1,parse:!1,transform:!1,handle:!1,beforeHandle:!1,afterHandle:!1,error:!1,context:!1,store:!1,set:!1})=>{for(let J of $){const[X,Z]=y1(J.toString()),Q=h$(X,W),B=f1(Q);if(B){const Y=Z1(B,Z);Y.splice(0,-1,B),d$(Z,Y,W);continue}if(W.request&&W.parse&&W.transform&&W.handle&&W.beforeHandle&&W.afterHandle&&W.error&&W.context&&W.store&&W.set)break}return W};import{Value as n0} from"@sinclair/typebox/value";import{Kind as U1} from"@sinclair/typebox";import{Value as z0} from"@sinclair/typebox/value";import{TypeCompiler as t1} from"@sinclair/typebox/compiler";var p$=function($,W){if(typeof $!=="string")throw new TypeError("argument str must be a string");var J={},X=W||{},Z=X.decode||i$,Q=0;while(Q<$.length){var B=$.indexOf("=",Q);if(B===-1)break;var Y=$.indexOf(";",Q);if(Y===-1)Y=$.length;else if(Y<B){Q=$.lastIndexOf(";",B-1)+1;continue}var G=$.slice(Q,B).trim();if(J[G]===void 0){var K=$.slice(B+1,Y).trim();if(K.charCodeAt(0)===34)K=K.slice(1,-1);J[G]=n$(K,Z)}Q=Y+1}return J},l$=function($,W,J){var X=J||{},Z=X.encode||s$;if(typeof Z!=="function")throw new TypeError("option encode is invalid");if(!m0.test($))throw new TypeError("argument name is invalid");var Q=Z(W);if(Q&&!m0.test(Q))throw new TypeError("argument val is invalid");var B=$+"="+Q;if(X.maxAge!=null){var Y=X.maxAge-0;if(isNaN(Y)||!isFinite(Y))throw new TypeError("option maxAge is invalid");B+="; Max-Age="+Math.floor(Y)}if(X.domain){if(!m0.test(X.domain))throw new TypeError("option domain is invalid");B+="; Domain="+X.domain}if(X.path){if(!m0.test(X.path))throw new TypeError("option path is invalid");B+="; Path="+X.path}if(X.expires){var G=X.expires;if(!t$(G)||isNaN(G.valueOf()))throw new TypeError("option expires is invalid");B+="; Expires="+G.toUTCString()}if(X.httpOnly)B+="; HttpOnly";if(X.secure)B+="; Secure";if(X.partitioned)B+="; Partitioned";if(X.priority){var K=typeof X.priority==="string"?X.priority.toLowerCase():X.priority;switch(K){case"low":B+="; Priority=Low";break;case"medium":B+="; Priority=Medium";break;case"high":B+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(X.sameSite){var _=typeof X.sameSite==="string"?X.sameSite.toLowerCase():X.sameSite;switch(_){case!0:B+="; SameSite=Strict";break;case"lax":B+="; SameSite=Lax";break;case"strict":B+="; SameSite=Strict";break;case"none":B+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return B},i$=function($){return $.indexOf("%")!==-1?decodeURIComponent($):$},s$=function($){return encodeURIComponent($)},t$=function($){return c$.call($)==="[object Date]"||$ instanceof Date},n$=function($,W){try{return W($)}catch(J){return $}};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var Q1=p$,B1=l$;var c$=Object.prototype.toString,m0=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;var p1=I0(d0(),1);class r{$;W;J;constructor($,W,J={}){this.name=$;this.jar=W;this.initial=J}get cookie(){if(!(this.name in this.jar))return this.initial;return this.jar[this.name]}set cookie($){if(!(this.name in this.jar))this.jar[this.name]=this.initial;this.jar[this.name]=$}get value(){return this.cookie.value}set value($){if(!(this.name in this.jar))this.jar[this.name]=this.initial;this.jar[this.name].value=$}get expires(){return this.cookie.expires}set expires($){this.cookie.expires=$}get maxAge(){return this.cookie.maxAge}set maxAge($){this.cookie.maxAge=$}get domain(){return this.cookie.domain}set domain($){this.cookie.domain=$}get path(){return this.cookie.path}set path($){this.cookie.path=$}get secure(){return this.cookie.secure}set secure($){this.cookie.secure=$}get httpOnly(){return this.cookie.httpOnly}set httpOnly($){this.cookie.httpOnly=$}get sameSite(){return this.cookie.sameSite}set sameSite($){this.cookie.sameSite=$}get priority(){return this.cookie.priority}set priority($){this.cookie.priority=$}get secrets(){return this.cookie.secrets}set secrets($){this.cookie.secrets=$}update($){return this.cookie=Object.assign(this.cookie,typeof $==="function"?$(this.cookie):$),this}set($){return this.cookie=Object.assign({...this.initial,value:this.value},typeof $==="function"?$(this.cookie):$),this}remove(){if(this.value===void 0)return;return this.set({expires:new Date(0),maxAge:0,value:""}),this}toString(){return typeof this.value==="object"?JSON.stringify(this.value):this.value?.toString()??""}}var c1=($,W,J)=>{if(!$.cookie)$.cookie={};return new Proxy(W,{get(X,Z){if(Z in W)return new r(Z,$.cookie,Object.assign({},J??{},W[Z]));return new r(Z,$.cookie,Object.assign({},J))}})},c0=async($,W,{secrets:J,sign:X,...Z}={})=>{if(!W)return c1($,{},Z);const Q=typeof J==="string";if(X&&X!==!0&&!Array.isArray(X))X=[X];const B={},Y=Q1(W);for(let[G,K]of Object.entries(Y)){let _=p1.default(K);if(X===!0||X?.includes(G)){if(!J)throw new Error("No secret is provided to cookie plugin");if(Q){const z=await G1(_,J);if(z===!1)throw new P0(G);_=z}else{let z=!0;for(let A=0;A<J.length;A++){const j=await G1(_,J[A]);if(j!==!1){z=!0,_=j;break}}if(!z)throw new P0(G)}}const F=_.charCodeAt(0);if(F===123||F===91)try{B[G]={value:JSON.parse(_)};continue}catch{}if(D0(_)){B[G]={value:parseInt(_)};continue}if(_==="true"){B[G]={value:!0};continue}if(_==="false"){B[G]={value:!1};continue}B[G]={value:_}}return c1($,B,Z)};var V0="toJSON"in new Headers,m=($)=>{if(!$)return!1;for(let W in $)return!0;return!1},S0=($,W)=>{const J=$.size;if(!W&&J||J&&W&&W.status!==206&&W.status!==304&&W.status!==412&&W.status!==416){if(W){if(W.headers instanceof Headers){if(V0)W.headers=W.headers.toJSON();else for(let[X,Z]of W.headers.entries())if(X in W.headers)W.headers[X]=Z}return new Response($,{status:W.status,headers:Object.assign({"accept-ranges":"bytes","content-range":`bytes 0-${J-1}/${J}`},W.headers)})}return new Response($,{headers:{"accept-ranges":"bytes","content-range":`bytes 0-${J-1}/${J}`}})}return new Response($)},l1=($,W)=>{if(!$)return $;$.delete("Set-Cookie");for(let J=0;J<W.length;J++){const X=W[J].indexOf("=");$.append("Set-Cookie",`${W[J].slice(0,X)}=${W[J].slice(X+1)||""}`)}return $},i1=($)=>{if(!$||!m($))return;const W=[];for(let[J,X]of Object.entries($)){if(!J||!X)continue;const Z=X.value;if(Z===void 0||Z===null)continue;W.push(B1(J,typeof Z==="object"?JSON.stringify(Z):Z+"",X))}if(W.length===0)return;if(W.length===1)return W[0];return W},u=($,W,J)=>{if($?.$passthrough)$=$?.[$.$passthrough];if($?.[d])W.status=$[d],$=$.response;if(m(W.headers)||W.status!==200||W.redirect||W.cookie){if(typeof W.status==="string")W.status=Z0[W.status];if(W.redirect){if(W.headers.Location=W.redirect,!W.status||W.status<300||W.status>=400)W.status=302}if(W.cookie&&m(W.cookie))W.headers["Set-Cookie"]=i1(W.cookie);if(W.headers["Set-Cookie"]&&Array.isArray(W.headers["Set-Cookie"]))W.headers=l1(new Headers(W.headers),W.headers["Set-Cookie"]);switch($?.constructor?.name){case"String":return new Response($,W);case"Blob":return S0($,W);case"Object":case"Array":return Response.json($,W);case"ReadableStream":if(!W.headers["content-type"]?.startsWith("text/event-stream"))W.headers["content-type"]="text/event-stream; charset=utf-8";return J?.signal.addEventListener("abort",{handleEvent(){if(!J?.signal.aborted)$.cancel(J)}},{once:!0}),new Response($,W);case void 0:if(!$)return new Response("",W);return Response.json($,W);case"Response":const X={...W.headers};if(V0)W.headers=$.headers.toJSON();else for(let[Z,Q]of $.headers.entries())if(Z in W.headers)W.headers[Z]=Q;for(let Z in X)$.headers.append(Z,X[Z]);return $;case"Error":return s($,W);case"Promise":return $.then((Z)=>u(Z,W));case"Function":return u($(),W);case"Number":case"Boolean":return new Response($.toString(),W);case"Cookie":if($ instanceof r)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response){const Z=Object.assign({},W.headers);if(V0)W.headers=$.headers.toJSON();else for(let[Q,B]of $.headers.entries())if(Q in W.headers)W.headers[Q]=B;for(let Q in Z)$.headers.append(Q,Z[Q]);return $}if($ instanceof Promise)return $.then((Z)=>u(Z,W));if($ instanceof Error)return s($,W);if("charCodeAt"in $){const Z=$.charCodeAt(0);if(Z===123||Z===91){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}}return new Response($,W)}}else switch($?.constructor?.name){case"String":return new Response($);case"Blob":return S0($,W);case"Object":case"Array":return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"ReadableStream":return J?.signal.addEventListener("abort",{handleEvent(){if(!J?.signal.aborted)$.cancel(J)}},{once:!0}),new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Error":return s($,W);case"Promise":return $.then((X)=>{const Z=o(X);if(Z!==void 0)return Z;return new Response("")});case"Function":return o($());case"Number":case"Boolean":return new Response($.toString());case"Cookie":if($ instanceof r)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((X)=>u(X,W));if($ instanceof Error)return s($,W);if("charCodeAt"in $){const X=$.charCodeAt(0);if(X===123||X===91){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}}return new Response($)}},h=($,W,J)=>{if($===void 0||$===null)return;if($?.$passthrough)$=$?.[$.$passthrough];if($?.[d])W.status=$[d],$=$.response;if(m(W.headers)||W.status!==200||W.redirect||W.cookie){if(typeof W.status==="string")W.status=Z0[W.status];if(W.redirect){if(W.headers.Location=W.redirect,!W.status||W.status<300||W.status>=400)W.status=302}if(W.cookie&&m(W.cookie))W.headers["Set-Cookie"]=i1(W.cookie);if(W.headers["Set-Cookie"]&&Array.isArray(W.headers["Set-Cookie"]))W.headers=l1(new Headers(W.headers),W.headers["Set-Cookie"]);switch($?.constructor?.name){case"String":return new Response($,W);case"Blob":return S0($,W);case"Object":case"Array":return Response.json($,W);case"ReadableStream":if(!W.headers["content-type"]?.startsWith("text/event-stream"))W.headers["content-type"]="text/event-stream; charset=utf-8";return J?.signal.addEventListener("abort",{handleEvent(){if(!J?.signal.aborted)$.cancel(J)}},{once:!0}),new Response($,W);case void 0:if(!$)return;return Response.json($,W);case"Response":const X=Object.assign({},W.headers);if(V0)W.headers=$.headers.toJSON();else for(let[Z,Q]of $.headers.entries())if(!(Z in W.headers))W.headers[Z]=Q;for(let Z in X)$.headers.append(Z,X[Z]);if($.status!==W.status)W.status=$.status;return $;case"Promise":return $.then((Z)=>{const Q=h(Z,W);if(Q!==void 0)return Q});case"Error":return s($,W);case"Function":return h($(),W);case"Number":case"Boolean":return new Response($.toString(),W);case"Cookie":if($ instanceof r)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response){const Z={...W.headers};if(V0)W.headers=$.headers.toJSON();else for(let[Q,B]of $.headers.entries())if(Q in W.headers)W.headers[Q]=B;for(let Q in Z)$.headers.append(Q,Z[Q]);return $}if($ instanceof Promise)return $.then((Z)=>h(Z,W));if($ instanceof Error)return s($,W);if("charCodeAt"in $){const Z=$.charCodeAt(0);if(Z===123||Z===91){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}}return new Response($,W)}}else switch($?.constructor?.name){case"String":return new Response($);case"Blob":return S0($,W);case"Object":case"Array":return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"ReadableStream":return J?.signal.addEventListener("abort",{handleEvent(){if(!J?.signal.aborted)$.cancel(J)}},{once:!0}),new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Promise":return $.then((X)=>{const Z=h(X,W);if(Z!==void 0)return Z});case"Error":return s($,W);case"Function":return o($());case"Number":case"Boolean":return new Response($.toString());case"Cookie":if($ instanceof r)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((X)=>h(X,W));if($ instanceof Error)return s($,W);if("charCodeAt"in $){const X=$.charCodeAt(0);if(X===123||X===91){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}}return new Response($)}},o=($,W)=>{if($?.$passthrough)$=$?.[$.$passthrough];if($?.[d])return u($.response,{status:$[d],headers:{}});switch($?.constructor?.name){case"String":return new Response($);case"Blob":return S0($);case"Object":case"Array":return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"ReadableStream":return W?.signal.addEventListener("abort",{handleEvent(){if(!W?.signal.aborted)$.cancel(W)}},{once:!0}),new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":return $;case"Error":return s($);case"Promise":return $.then(o);case"Function":return o($());case"Number":case"Boolean":return new Response($.toString());default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then(o);if($ instanceof Error)return s($);if("charCodeAt"in $){const J=$.charCodeAt(0);if(J===123||J===91)return new Response(JSON.stringify($),{headers:{"Content-Type":"application/json"}})}return new Response($)}},s=($,W)=>new Response(JSON.stringify({name:$?.name,message:$?.message,cause:$?.cause}),{status:W?.status!==200?W?.status??500:500,headers:W?.headers});var B9=function($){let W=$;while(W.endsWith("="))W=W.slice(0,-1);return W},_1=($,W)=>{const J=new URL($);return J.pathname=W,J.toString()},e$=($)=>typeof $==="function"&&/^\s*class\s+/.test($.toString())||$.toString().startsWith("[object ")||m(Object.getPrototypeOf($)),K1=($)=>$&&typeof $==="object"&&!Array.isArray($),p=($,W,{skipKeys:J}={})=>{if(K1($)&&K1(W))for(let[X,Z]of Object.entries(W)){if(J?.includes(X))continue;if(!K1(Z)||!(X in $)||e$(Z)){$[X]=Z;continue}$[X]=p($[X],Z)}return $},$9=($,W)=>{const{properties:J,...X}=$??{},{properties:Z,...Q}=W??{};return p(X,Q)},b=($=[],W=[])=>{if(!$)return[];if(!W)return $;const J=[],X=[];if(!Array.isArray($))$=[$];if(!Array.isArray(W))W=[W];for(let Z of $)if(J.push(Z),Z.checksum)X.push(Z.checksum);for(let Z of W)if(!X.includes(Z.checksum))J.push(Z);return J},W9=["start","request","parse","transform","resolve","beforeHandle","afterHandle","onResponse","mapResponse","trace","error","stop","body","headers","params","query","response","type","detail"],J9=W9.reduce(($,W)=>($[W]=!0,$),{}),X9=($,W)=>{const J=(X)=>typeof X==="object"&&Object.keys(X).every(D0);if(J($)&&J(W))return{...$,...W};return W??$},f=($,W,{allowMacro:J=!1}={})=>{return{...J?{...$,...W}:void 0,body:W?.body??$?.body,headers:W?.headers??$?.headers,params:W?.params??$?.params,query:W?.query??$?.query,response:X9($?.response,W?.response),type:$?.type||W?.type,detail:p(W?.detail??{},$?.detail??{}),parse:b($?.parse,W?.parse),transform:b($?.transform,W?.transform),beforeHandle:b($?.beforeHandle,W?.beforeHandle),afterHandle:b($?.afterHandle,W?.afterHandle),onResponse:b($?.onResponse,W?.onResponse),mapResponse:b($?.mapResponse,W?.mapResponse),trace:b($?.trace,W?.trace),error:b($?.error,W?.error)}},k=($,{models:W={},dynamic:J=!1,normalize:X=!1,additionalProperties:Z=X})=>{if(!$)return;if(typeof $==="string"&&!($ in W))return;const Q=typeof $==="string"?W[$]:$;if(Q.type==="object"&&"additionalProperties"in Q===!1)Q.additionalProperties=Z;const B=(G)=>z0.Clean(Q,G);if(J){const G={schema:Q,references:"",checkFunc:()=>{},code:"",Check:(K)=>z0.Check(Q,K),Errors:(K)=>z0.Errors(Q,K),Code:()=>""};if(X&&Q.additionalProperties===!0)G.Clean=B;if(Q.config){if(G.config=Q.config,G?.schema?.config)delete G.schema.config}return G}const Y=t1.Compile(Q,Object.values(W));if(Y.Clean=B,Q.config){if(Y.config=Q.config,Y?.schema?.config)delete Y.schema.config}return Y},p0=($,{models:W={},dynamic:J=!1,normalize:X=!1,additionalProperties:Z=X})=>{if(!$)return;if(typeof $==="string"&&!($ in W))return;const Q=typeof $==="string"?W[$]:$,B=(G,K)=>{const _=(z)=>z0.Clean(G,z);if(J)return{schema:G,references:"",checkFunc:()=>{},code:"",Check:(z)=>z0.Check(G,z),Errors:(z)=>z0.Errors(G,z),Code:()=>""};const F=t1.Compile(G,K);if(X&&G.additionalProperties===!0)F.Clean=_;return F};if(U1 in Q){if("additionalProperties"in Q===!1)Q.additionalProperties=Z;return{200:B(Q,Object.values(W))}}const Y={};return Object.keys(Q).forEach((G)=>{const K=Q[+G];if(typeof K==="string"){if(K in W){const _=W[K];_.type==="object"&&"additionalProperties"in _,Y[+G]=U1 in _?B(_,Object.values(W)):_}return}if(K.type==="object"&&"additionalProperties"in K===!1)K.additionalProperties=Z;Y[+G]=U1 in K?B(K,Object.values(W)):K}),Y},Z9=typeof Bun!=="undefined",Q9=Z9&&typeof Bun.hash==="function",C0=($)=>{if(Q9)return Bun.hash($);let W=9;for(let J=0;J<$.length;)W=Math.imul(W^$.charCodeAt(J++),387420489);return W=W^W>>>9},l0=({validator:$,defaultConfig:W={},config:J,dynamic:X,models:Z})=>{let Q=k($,{dynamic:X,models:Z,additionalProperties:!0});if(m(W))if(Q)Q.config=$9(Q.config,J);else Q=k(C.Cookie({}),{dynamic:X,models:Z,additionalProperties:!0}),Q.config=W;return Q},i0=($,W,J)=>{const X=(Z)=>{if(!Z)return;if(!Array.isArray(Z)){const B=Z;if(J&&!B.checksum)B.checksum=J;if(B.scope==="scoped")B.scope="local";return B}const Q=[...Z];for(let B of Q){if(J&&!B.checksum)B.checksum=J;if(B.scope==="scoped")B.scope="local"}return Q};return{start:b($.start,X(W?.start)),request:b($.request,X(W?.request)),parse:b($.parse,X(W?.parse)),transform:b($.transform,X(W?.transform)),beforeHandle:b($.beforeHandle,X(W?.beforeHandle)),afterHandle:b($.afterHandle,X(W?.afterHandle)),mapResponse:b($.mapResponse,X(W?.mapResponse)),onResponse:b($.onResponse,X(W?.onResponse)),trace:$.trace,error:b($.error,X(W?.error)),stop:b($.stop,X(W?.stop))}},n1=($,W,{skipIfHasType:J=!1}={})=>{if(!$)return $;if(!Array.isArray($)){if(J)$.scope??=W;else $.scope=W;return $}for(let X of $)if(J)X.scope??=W;else X.scope=W;return $},Q0=($)=>{if(!$)return $;if(!Array.isArray($))switch($.scope){case"global":case"scoped":return{...$};default:return{fn:$}}const W=[];for(let J of $)switch(J.scope){case"global":case"scoped":W.push({...J});break}return W},F1=($)=>{return{...$,type:$?.type,detail:$?.detail,parse:Q0($?.parse),transform:Q0($?.transform),beforeHandle:Q0($?.beforeHandle),afterHandle:Q0($?.afterHandle),onResponse:Q0($?.onResponse),error:Q0($?.error),mapResponse:Q0($?.mapResponse)}},Z0={Continue:100,"Switching Protocols":101,Processing:102,"Early Hints":103,OK:200,Created:201,Accepted:202,"Non-Authoritative Information":203,"No Content":204,"Reset Content":205,"Partial Content":206,"Multi-Status":207,"Already Reported":208,"Multiple Choices":300,"Moved Permanently":301,Found:302,"See Other":303,"Not Modified":304,"Temporary Redirect":307,"Permanent Redirect":308,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,"Method Not Allowed":405,"Not Acceptable":406,"Proxy Authentication Required":407,"Request Timeout":408,Conflict:409,Gone:410,"Length Required":411,"Precondition Failed":412,"Payload Too Large":413,"URI Too Long":414,"Unsupported Media Type":415,"Range Not Satisfiable":416,"Expectation Failed":417,"I'm a teapot":418,"Misdirected Request":421,"Unprocessable Content":422,Locked:423,"Failed Dependency":424,"Too Early":425,"Upgrade Required":426,"Precondition Required":428,"Too Many Requests":429,"Request Header Fields Too Large":431,"Unavailable For Legal Reasons":451,"Internal Server Error":500,"Not Implemented":501,"Bad Gateway":502,"Service Unavailable":503,"Gateway Timeout":504,"HTTP Version Not Supported":505,"Variant Also Negotiates":506,"Insufficient Storage":507,"Loop Detected":508,"Not Extended":510,"Network Authentication Required":511},s0=Object.fromEntries(Object.entries(Z0).map(([$,W])=>[W,$])),s1=new TextEncoder,w0=async($,W)=>{if(typeof $!=="string")throw new TypeError("Cookie value must be provided as a string.");if(W===null)throw new TypeError("Secret key must be provided.");const J=await crypto.subtle.importKey("raw",s1.encode(W),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),X=await crypto.subtle.sign("HMAC",J,s1.encode($));return $+"."+B9(Buffer.from(X).toString("base64"))},G1=async($,W)=>{if(typeof $!=="string")throw new TypeError("Signed cookie string must be provided.");if(W===null)throw new TypeError("Secret key must be provided.");const J=$.slice(0,$.lastIndexOf("."));return await w0(J,W)===$?J:!1},D1=($,W,J=W)=>{if(!$||typeof $!=="object"||!W)return;for(let[X,Z]of Object.entries(W)){if(X in J9||!(X in $))continue;const Q=$[X];if(typeof Q==="function")Q(Z);else if(typeof Q==="object")D1(Q,Z,J)}},r1=({globalHook:$,localHook:W})=>(J)=>(X,Z)=>{if(typeof X==="function")X={fn:X};if("fn"in X||Array.isArray(X)){if(!W[J])W[J]=[];if(typeof W[J]==="function")W[J]=[W[J]];if(Array.isArray(X))W[J]=W[J].concat(X);else W[J].push(X);return}const{insert:Q="after",stack:B="local"}=X;if(typeof Z==="function")Z={fn:Z};if(B==="global")if(!Array.isArray(Z))if(Q==="before")$[J].unshift(Z);else $[J].push(Z);else if(Q==="before")$[J]=Z.concat($[J]);else $[J]=$[J].concat(Z);else{if(!W[J])W[J]=[];if(typeof W[J]==="function")W[J]=[W[J]];if(!Array.isArray(Z))if(Q==="before")W[J].unshift(Z);else W[J].push(Z);else if(Q==="before")W[J]=Z.concat(W[J]);else W[J]=W[J].concat(Z)}},D0=($)=>{if($.length<16)return $.trim().length!==0&&!Number.isNaN(Number($));if($.length===16){const W=Number($);if(W.toString()===$)return $.trim().length!==0&&!Number.isNaN(W)}return!1};class z1{$;root=null;promises=[];constructor($=console.error){this.onError=$}get size(){return this.promises.length}add($){return this.promises.push($),this.root||=this.drain(),$}async drain(){while(this.promises.length>0){try{await this.promises[0]}catch($){this.onError($)}this.promises.shift()}this.root=null}then($,W){return(this.root??Promise.resolve()).then($,W)}}var c=($)=>{if(!$)return $;if(!Array.isArray($)){if(typeof $==="function")return{fn:$};else if("fn"in $)return $}const W=[];for(let J of $)if(typeof J==="function")W.push({fn:J});else if("fn"in J)W.push(J);return W},o1=($)=>{return{...$,start:c($?.start),request:c($?.request),parse:c($?.parse),transform:c($?.transform),beforeHandle:c($?.beforeHandle),afterHandle:c($?.afterHandle),onResponse:c($?.onResponse),mapResponse:c($?.mapResponse),trace:c($?.trace),error:c($?.error),stop:c($?.stop)}},a1=($)=>{return{...$,start:$.start?.map((W)=>W.fn),request:$.request?.map((W)=>W.fn),parse:$.parse?.map((W)=>W.fn),transform:$.transform?.map((W)=>W.fn),beforeHandle:$.beforeHandle?.map((W)=>W.fn),afterHandle:$.afterHandle?.map((W)=>W.fn),onResponse:$.onResponse?.map((W)=>W.fn),mapResponse:$.mapResponse?.map((W)=>W.fn),trace:$.trace?.map((W)=>W.fn),error:$.error?.map((W)=>W.fn),stop:$.stop?.map((W)=>W.fn)}},t0=($)=>({event:{body:$.event.body,cookie:$.event.cookie,headers:$.event.headers,queries:[...$.event.queries],query:$.event.query,set:$.event.set,unknownQueries:$.event.unknownQueries},trace:{request:$.trace.request,parse:$.trace.parse,transform:$.trace.transform,handle:$.trace.handle,beforeHandle:$.trace.beforeHandle,afterHandle:$.trace.afterHandle,error:$.trace.error,context:$.trace.context,store:$.trace.store,set:$.trace.set}}),w1=($,W=301)=>new Response(null,{status:W,headers:{Location:$}});var e1=typeof Bun!=="undefined"?Bun.env:typeof process!=="undefined"?process?.env:void 0,B0=Symbol("ElysiaErrorCode"),d=Symbol("ElysiaResponse"),T0=(e1?.NODE_ENV??e1?.ENV)==="production",M1=($,W)=>({[d]:Z0[$]??$,response:W??($ in s0?s0[$]:$),_type:void 0});class r0 extends Error{code="INTERNAL_SERVER_ERROR";status=500;constructor($){super($??"INTERNAL_SERVER_ERROR")}}class Y0 extends Error{code="NOT_FOUND";status=404;constructor($){super($??"NOT_FOUND")}}class o0 extends Error{W;code="PARSE";status=400;constructor($,W){super($??"PARSE");this.body=W}}class P0 extends Error{$;code="INVALID_COOKIE_SIGNATURE";status=400;constructor($,W){super(W??`"${$}" has invalid cookie signature`);this.key=$}}class q extends Error{$;W;J;code="VALIDATION";status=422;constructor($,W,J){if(typeof J==="object"&&d in J)J=J.response;const X=T0?void 0:("Errors"in W)?W.Errors(J).First():n0.Errors(W,J).First(),Z=X?.schema.error?typeof X.schema.error==="function"?X.schema.error($,W,J):X.schema.error:void 0,Q=X?.path||"root";let B="";if(Z)B=typeof Z==="object"?JSON.stringify(Z):Z+"";else if(T0)B=JSON.stringify({type:"validation",on:$,message:X?.message,found:J});else{const Y=W?.schema??W,G="Errors"in W?[...W.Errors(J)]:[...n0.Errors(W,J)];let K;try{K=n0.Create(Y)}catch(_){K={type:"Could not create expected value",message:_?.message,error:_}}B=JSON.stringify({type:"validation",on:$,property:Q,message:X?.message,expected:K,found:J,errors:G},null,2)}super(B);this.type=$;this.validator=W;this.value=J;Object.setPrototypeOf(this,q.prototype)}get all(){return[...this.validator.Errors(this.value)]}static simplifyModel($){const W="schema"in $?$.schema:$;try{return n0.Create(W)}catch{return W}}get model(){return q.simplifyModel(this.validator)}toResponse($){return new Response(this.message,{status:400,headers:{...$,"content-type":"application/json"}})}}var A1={open($){$.data.open?.($)},message($,W){$.data.message?.($,W)},drain($){$.data.drain?.($)},close($,W,J){$.data.close?.($,W,J)}};class M0{$;W;validator;constructor($,W){this.raw=$;this.data=W;if(this.validator=$.data.validator,$.data.id)this.id=$.data.id;else{const J=new Uint32Array(1);crypto.getRandomValues(J),this.id=J[0].toString()}}get id(){return this.raw.data.id}set id($){this.raw.data.id=$}get publish(){return($,W=void 0,J)=>{if(this.validator?.Check(W)===!1)throw new q("message",this.validator,W);if(typeof W==="object")W=JSON.stringify(W);return this.raw.publish($,W,J),this}}get send(){return($)=>{if(this.validator?.Check($)===!1)throw new q("message",this.validator,$);if(Buffer.isBuffer($))return this.raw.send($),this;if(typeof $==="object")$=JSON.stringify($);return this.raw.send($),this}}get subscribe(){return($)=>{return this.raw.subscribe($),this}}get unsubscribe(){return($)=>{return this.raw.unsubscribe($),this}}get cork(){return($)=>{return this.raw.cork($),this}}get close(){return()=>{return this.raw.close(),this}}get terminate(){return this.raw.terminate.bind(this.raw)}get isSubscribed(){return this.raw.isSubscribed.bind(this.raw)}get remoteAddress(){return this.raw.remoteAddress}}var D$=I0(N1(),1),z$=I0(d0(),1);import{Value as L0} from"@sinclair/typebox/value";var _9=(new Headers()).toJSON,w$={value:0},M$=({hasTrace:$,hasTraceSet:W=!1,addFn:J,condition:X={}})=>{if($)return J("\nconst reporter = getReporter()\n"),(Z,{name:Q,attribute:B="",unit:Y=0}={})=>{const G=Z.indexOf("."),K=G===-1;if(Z!=="request"&&Z!=="response"&&!X[K?Z:Z.slice(0,G)])return()=>{if(W&&Z==="afterHandle")J("\nawait traceDone\n")};if(K)Q||=Z;else Q||="anonymous";return J("\n"+`reporter.emit('event', {
					id,
					event: '${Z}',
					type: 'begin',
					name: '${Q}',
					time: performance.now(),
					${K?`unit: ${Y},`:""}
					${B}
				})`.replace(/(\t| |\n)/g,"")+"\n"),()=>{if(J("\n"+`reporter.emit('event', {
							id,
							event: '${Z}',
							type: 'end',
							time: performance.now()
						})`.replace(/(\t| |\n)/g,"")+"\n"),W&&Z==="afterHandle")J("\nawait traceDone\n")}};else return()=>()=>{}},R0=($)=>{const W=$.indexOf(")");if($.charCodeAt(W+2)===61&&$.charCodeAt(W+5)!==123)return!0;return $.includes("return")},F9=($,{injectResponse:W="",normalize:J=!1}={})=>({composeValidation:(X,Z=`c.${X}`)=>$?`c.set.status = 422; throw new ValidationError('${X}', ${X}, ${Z})`:`c.set.status = 422; return new ValidationError('${X}', ${X}, ${Z}).toResponse(c.set.headers)`,composeResponseValidation:(X="r")=>{const Z=$?`throw new ValidationError('response', response[c.set.status], ${X})`:`return new ValidationError('response', response[c.set.status], ${X}).toResponse(c.set.headers)`;let Q="\n"+W+"\n";if(Q+=`let er

		if(${X} && typeof ${X} === "object" && ELYSIA_RESPONSE in ${X})
			er = ${X}[ELYSIA_RESPONSE]\n`,J)Q+=`
			if(!er && response[c.set.status]?.Clean)
				${X} = response[c.set.status]?.Clean(${X})
			else if(response[er]?.Clean)
				${X}.response = response[er]?.Clean(${X}.response)`;return Q+=`
			if(er) {
				if(!(${X} instanceof Response) && response[er]?.Check(${X}.response) === false) {
					if(!(response instanceof Error)) {
						c.set.status = ${X}[ELYSIA_RESPONSE]

						${Z}
					}
				}
			} else if(!(${X} instanceof Response) && response[c.set.status]?.Check(${X}) === false) {
				if(!(response instanceof Error))
					${Z}
			}\n`,Q}}),V6=Symbol.for("TypeBox.Kind");var G0=($,W)=>{if(!W)return;if(W.type==="object"){const J=W.properties;if(!J)return!1;for(let X of Object.keys(J)){const Z=J[X];if($ in Z)return!0;if(Z.type==="object"){if(G0($,Z))return!0}else if(Z.anyOf){for(let Q=0;Q<Z.anyOf.length;Q++)if(G0($,Z.anyOf[Q]))return!0}}return!1}return $ in W},I1=Symbol.for("TypeBox.Transform"),A0=($)=>{if(!$)return;if($.type==="object"&&$.properties){const W=$.properties;for(let J of Object.keys(W)){const X=W[J];if(X.type==="object"){if(A0(X))return!0}else if(X.anyOf){for(let Q=0;Q<X.anyOf.length;Q++)if(A0(X.anyOf[Q]))return!0}if(I1 in X)return!0}return!1}return I1 in $||$.properties&&I1 in $.properties},D9=/(?:return|=>) \S+\(/g,x=($)=>{const W="fn"in $?$.fn:$;if(W.constructor.name==="AsyncFunction")return!0;const J=W.toString();if(J.includes("=> response.clone("))return!1;if(J.includes("await"))return!0;if(J.includes("async"))return!0;return!!J.match(D9)},a0=({app:$,path:W,method:J,localHook:X,hooks:Z,validator:Q,handler:B,allowMeta:Y=!1,appInference:{event:G,trace:K}})=>{const _=typeof B==="function";if(!_)B=u(B,{headers:$.setHeaders??{}});const F=$.config.forceErrorEncapsulation&&(_||Z.afterHandle.length>0||Z.beforeHandle.length>0||Z.transform.length>0)||Z.error.length>0||$.event.error.length>0||typeof Bun==="undefined"||Z.onResponse.length>0||!!Z.trace.length,z=_?"handler(c)":"handler",A=Z.onResponse.length?`\n;(async () => {${Z.onResponse.map((O,w)=>`await res${w}(c)`).join(";")}})();\n`:"",j=K,V=Z.trace.length>0;let U="";const D=u0(Object.assign(X,{handler:B}),G),I=D.query||!!Q.query,N=J!=="$INTERNALWS"&&J!=="GET"&&J!=="HEAD"&&Z.type!=="none"&&(D.body||!!Q.body),R=$.setHeaders,T=R&&!!Object.keys(R).length,$0=D.headers||Q.headers,v=D.cookie||!!Q.cookie,n=v?l0({validator:Q.cookie,defaultConfig:$.config.cookie,dynamic:!!$.config.aot,config:Q.cookie?.config??{},models:$.definitions.type}):void 0,S=n?.config;let P="";if(S?.sign){if(!S.secrets)throw new Error(`t.Cookie required secret which is not set in (${J}) ${W}.`);const O=!S.secrets?void 0:typeof S.secrets==="string"?S.secrets:S.secrets[0];if(P+=`const _setCookie = c.set.cookie
		if(_setCookie) {`,S.sign===!0)P+=`for(const [key, cookie] of Object.entries(_setCookie)) {
				c.set.cookie[key].value = await signCookie(cookie.value, '${O}')
			}`;else for(let w of S.sign)P+=`if(_setCookie['${w}']?.value) { c.set.cookie['${w}'].value = await signCookie(_setCookie['${w}'].value, '${O}') }\n`;P+="}\n"}const W0=$.config.normalize,{composeValidation:U0,composeResponseValidation:H0}=F9(F,{normalize:W0});if($0)U+=_9?"c.headers = c.request.headers.toJSON()\n":`c.headers = {}
                for (const [key, value] of c.request.headers.entries())
					c.headers[key] = value
				`;if(v){const O=(M,L)=>{const H=S?.[M]??L;if(!H)return typeof L==="string"?`${M}: "${L}",`:`${M}: ${L},`;if(typeof H==="string")return`${M}: '${H}',`;if(H instanceof Date)return`${M}: new Date(${H.getTime()}),`;return`${M}: ${H},`},w=S?`{
			secrets: ${S.secrets!==void 0?typeof S.secrets==="string"?`'${S.secrets}'`:"["+S.secrets.reduce((M,L)=>M+`'${L}',`,"")+"]":"undefined"},
			sign: ${S.sign===!0?!0:S.sign!==void 0?"["+S.sign.reduce((M,L)=>M+`'${L}',`,"")+"]":"undefined"},
			${O("domain")}
			${O("expires")}
			${O("httpOnly")}
			${O("maxAge")}
			${O("path","/")}
			${O("priority")}
			${O("sameSite")}
			${O("secure")}
		}`:"undefined";if($0)U+=`\nc.cookie = await parseCookie(c.set, c.headers.cookie, ${w})\n`;else U+=`\nc.cookie = await parseCookie(c.set, c.request.headers.get('cookie'), ${w})\n`}if(I){let O=[];if(Q.query&&Q.query.schema.type==="object")O=Object.keys(Q.query.schema.properties);else for(let w of D.queries)if(O.indexOf(w)===-1)O.push(w);if($.config.forceDynamicQuery===!0||D.unknownQueries===!0||!O.length)U+=`if(c.qi !== -1) {
				c.query = parseQuery(c.request.url.slice(c.qi + 1).replace(/\\+/g, ' '))

				for(const key of Object.keys(c.query))
					c.query[key] = decodeURIComponent(c.query[key])
			} else c.query = {}`;else U+=`if(c.qi !== -1) {
				let url = c.request.url.slice(c.qi).replace(/\\+/g, ' ')

				${O.map((w,M)=>`
						${M===0?"let":""} memory = url.indexOf('&${w}=')
						if(memory === -1) memory = url.indexOf('?${w}=')
						let a${M}

						if(memory !== -1) {
							const start = memory + ${w.length+2}
							memory = url.indexOf('&', start)

							if(memory === -1) a${M} = decodeURIComponent(url.slice(start))
							else a${M} = decodeURIComponent(url.slice(start, memory))
						}`).join("\n")}

				c.query = {
					${O.map((w,M)=>`'${w}': a${M}`).join(", ")}
				}
			} else {
				c.query = {}
			}`}const x0=K.set,g0=D.cookie||D.set||x0||$0||_&&T;if(V)U+="\nconst id = c.$$requestId\n";const E=M$({hasTrace:V,hasTraceSet:x0,condition:j,addFn:(O)=>{U+=O}});if(U+=F?"\n try {\n":"",x0){U+="\nconst traceDone = Promise.all([";for(let O=0;O<Z.trace.length;O++)U+=`new Promise(r => { reporter.once(\`res\${id}.${O}\`, r) }),`;U+="])\n"}const K0=typeof B==="function"&&x(B),W1=v||N||x0||K0||!!Z.mapResponse.length||Z.parse.length>0||Z.afterHandle.some(x)||Z.beforeHandle.some(x)||Z.transform.some(x),q$=E("parse",{unit:Z.parse.length});if(N){const O=Z.parse.length||D.body||Q.body;if(Z.type&&!Z.parse.length)switch(Z.type){case"json":case"application/json":if(F)U+=`const tempBody = await c.request.text()

							try {
								c.body = JSON.parse(tempBody)
							} catch {
								throw new ParseError('Failed to parse body as found: ' + (typeof body === "string" ? "'" + body + "'" : body), body)
							}`;else U+="c.body = await c.request.json()";break;case"text":case"text/plain":U+="c.body = await c.request.text()\n";break;case"urlencoded":case"application/x-www-form-urlencoded":U+="c.body = parseQuery(await c.request.text())\n";break;case"arrayBuffer":case"application/octet-stream":U+="c.body = await c.request.arrayBuffer()\n";break;case"formdata":case"multipart/form-data":U+=`c.body = {}

						const form = await c.request.formData()
						for (const key of form.keys()) {
							if (c.body[key])
								continue

							const value = form.getAll(key)
							if (value.length === 1)
								c.body[key] = value[0]
							else c.body[key] = value
						}\n`;break}else if(O){if(U+="\n",U+=$0?"let contentType = c.headers['content-type']":"let contentType = c.request.headers.get('content-type')",U+=`
				if (contentType) {
					const index = contentType.indexOf(';')
					if (index !== -1) contentType = contentType.substring(0, index)\n
					c.contentType = contentType\n`,Z.parse.length){U+="let used = false\n";const w=E("parse",{unit:Z.parse.length});for(let M=0;M<Z.parse.length;M++){const L=E("parse.unit",{name:Z.parse[M].fn.name}),H=`bo${M}`;if(M!==0)U+="if(!used) {\n";if(U+=`let ${H} = parse[${M}](c, contentType)\n`,U+=`if(${H} instanceof Promise) ${H} = await ${H}\n`,U+=`if(${H} !== undefined) { c.body = ${H}; used = true }\n`,L(),M!==0)U+="}"}w()}if(U+="\ndelete c.contentType\n",Z.parse.length)U+="if (!used) {";if(Z.type&&!Array.isArray(Z.type))switch(Z.type){case"json":case"application/json":if(F)U+=`const tempBody = await c.request.text()
	
								try {
									c.body = JSON.parse(tempBody)
								} catch {
									throw new ParseError('Failed to parse body as found: ' + (typeof body === "string" ? "'" + body + "'" : body), body)
								}`;else U+="c.body = await c.request.json()";break;case"text":case"text/plain":U+="c.body = await c.request.text()\n";break;case"urlencoded":case"application/x-www-form-urlencoded":U+="c.body = parseQuery(await c.request.text())\n";break;case"arrayBuffer":case"application/octet-stream":U+="c.body = await c.request.arrayBuffer()\n";break;case"formdata":case"multipart/form-data":U+=`c.body = {}
	
							const form = await c.request.formData()
							for (const key of form.keys()) {
								if (c.body[key])
									continue
	
								const value = form.getAll(key)
								if (value.length === 1)
									c.body[key] = value[0]
								else c.body[key] = value
							}\n`;break}else U+=`
					switch (contentType) {
						case 'application/json':
							${F?`
							const tempBody = await c.request.text()

							try {
								c.body = JSON.parse(tempBody)
							} catch {
								throw new ParseError('Failed to parse body as found: ' + (typeof body === "string" ? "'" + body + "'" : body), body)
							}
							`:"c.body = await c.request.json()\n"}
							break

						case 'text/plain':
							c.body = await c.request.text()
							break

						case 'application/x-www-form-urlencoded':
							c.body = parseQuery(await c.request.text())
							break

						case 'application/octet-stream':
							c.body = await c.request.arrayBuffer();
							break

						case 'multipart/form-data':
							c.body = {}

							const form = await c.request.formData()
							for (const key of form.keys()) {
								if (c.body[key])
									continue

								const value = form.getAll(key)
								if (value.length === 1)
									c.body[key] = value[0]
								else c.body[key] = value
							}

							break
					}`;if(Z.parse.length)U+="}";U+="}\n"}U+="\n"}if(q$(),Z?.transform){const O=E("transform",{unit:Z.transform.length});if(Z.transform.length)U+="\nlet transformed\n";for(let w=0;w<Z.transform.length;w++){const M=Z.transform[w],L=E("transform.unit",{name:M.fn.name});U+=x(M)?`transformed = await transform[${w}](c)\n`:`transformed = transform[${w}](c)\n`,U+=`if(transformed?.[ELYSIA_RESPONSE])
				throw transformed
			else
				Object.assign(c, transformed)\n`,L()}O()}if(Q){if(U+="\n",Q.headers){if(G0("default",Q.headers.params))for(let[O,w]of Object.entries(L0.Default(Q.headers.schema,{}))){const M=typeof w==="object"?JSON.stringify(w):`'${w}'`;if(M)U+=`c.headers['${O}'] ??= ${M}\n`}if(U+=`if(headers.Check(c.headers) === false) {
				${U0("headers")}
			}`,A0(Q.headers.schema))U+="\nc.headers = headers.Decode(c.headers)\n"}if(Q.params){if(G0("default",Q.params.schema))for(let[O,w]of Object.entries(L0.Default(Q.params.schema,{}))){const M=typeof w==="object"?JSON.stringify(w):`'${w}'`;if(M)U+=`c.params['${O}'] ??= ${M}\n`}if(U+=`if(params.Check(c.params) === false) {
				${U0("params")}
			}`,A0(Q.params.schema))U+="\nc.params = params.Decode(c.params)\n"}if(Q.query){if(W0)U+="c.query = query.Clean(c.query);\n";if(G0("default",Q.query.schema))for(let[O,w]of Object.entries(L0.Default(Q.query.schema,{}))){const M=typeof w==="object"?JSON.stringify(w):`'${w}'`;if(M)U+=`c.query['${O}'] ??= ${M}\n`}if(U+=`if(query.Check(c.query) === false) {
				${U0("query")}
			}`,A0(Q.query.schema))U+="\nc.query = query.Decode(Object.assign({}, c.query))\n"}if(Q.body){if(W0)U+="c.body = body.Clean(c.body);\n";if(G0("default",Q.body.schema))U+=`if(body.Check(c.body) === false) {
    				c.body = Object.assign(${JSON.stringify(L0.Default(Q.body.schema,null)??{})}, c.body)

    				if(body.Check(c.query) === false) {
        				${U0("body")}
     			}
            }`;else U+=`if(body.Check(c.body) === false) {
			${U0("body")}
		}`;if(A0(Q.body.schema))U+="\nc.body = body.Decode(c.body)\n"}if(m(n?.schema.properties??{})){if(U+=`const cookieValue = {}
    			for(const [key, value] of Object.entries(c.cookie))
    				cookieValue[key] = value.value\n`,G0("default",n.schema))for(let[O,w]of Object.entries(L0.Default(n.schema,{})))U+=`cookieValue['${O}'] = ${typeof w==="object"?JSON.stringify(w):w}\n`;U+=`if(cookie.Check(cookieValue) === false) {
				${U0("cookie","cookieValue")}
			}`}}if(Z?.beforeHandle){const O=E("beforeHandle",{unit:Z.beforeHandle.length});let w=!1;for(let M=0;M<Z.beforeHandle.length;M++){const L=Z.beforeHandle[M],H=E("beforeHandle.unit",{name:L.fn.name}),y0=R0(L.fn.toString());if(L.subType==="resolve"){if(!w)w=!0,U+="\nlet resolved\n";U+=x(L)?`resolved = await beforeHandle[${M}](c);\n`:`resolved = beforeHandle[${M}](c);\n`,U+=`if(resolved[ELYSIA_RESPONSE])
						throw resolved
					else
						Object.assign(c, resolved)\n`}else if(!y0)U+=x(L)?`await beforeHandle[${M}](c);\n`:`beforeHandle[${M}](c);\n`,H();else{U+="Object.assign(c, be);",U+=x(L)?`be = await beforeHandle[${M}](c);\n`:`be = beforeHandle[${M}](c);\n`,H(),U+="if(be !== undefined) {\n",O();const L$=E("afterHandle",{unit:Z.transform.length});if(Z.afterHandle){E("handle",{name:_?B.name:void 0})();for(let l=0;l<Z.afterHandle.length;l++){const v0=Z.afterHandle[l],R$=R0(v0.fn.toString()),E$=E("afterHandle.unit",{name:v0.fn.name});if(U+="c.response = be\n",!R$)U+=x(v0.fn)?`await afterHandle[${l}](c, be)\n`:`afterHandle[${l}](c, be)\n`;else U+=x(v0.fn)?`af = await afterHandle[${l}](c)\n`:`af = afterHandle[${l}](c)\n`,U+="if(af !== undefined) { c.response = be = af }\n";E$()}}if(L$(),Q.response)U+=H0("be");if(Z.mapResponse.length){U+="c.response = be";for(let l=0;l<Z.mapResponse.length;l++)U+=`\nif(mr === undefined) {
							mr = onMapResponse[${l}](c)
							if(mr instanceof Promise) mr = await mr
							if(mr !== undefined) c.response = mr
						}\n`}U+=P,U+="return mapEarlyResponse(be, c.set, c.request)}\n"}}O()}if(Z?.afterHandle.length){const O=E("handle",{name:_?B.name:void 0});if(Z.afterHandle.length)U+=K0?`let r = c.response = await ${z};\n`:`let r = c.response = ${z};\n`;else U+=K0?`let r = await ${z};\n`:`let r = ${z};\n`;O();const w=E("afterHandle",{unit:Z.afterHandle.length});for(let M=0;M<Z.afterHandle.length;M++){const L=Z.afterHandle[M],H=R0(L.fn.toString()),y0=E("afterHandle.unit",{name:L.fn.name});if(!H)U+=x(L.fn)?`await afterHandle[${M}](c)\n`:`afterHandle[${M}](c)\n`,y0();else if(U+=x(L.fn)?`af = await afterHandle[${M}](c)\n`:`af = afterHandle[${M}](c)\n`,y0(),Q.response)U+="if(af !== undefined) {",w(),U+=H0("af"),U+="c.response = af }";else U+="if(af !== undefined) {",w(),U+="c.response = af}\n"}if(w(),U+="r = c.response\n",Q.response)U+=H0();if(U+=P,Z.mapResponse.length)for(let M=0;M<Z.mapResponse.length;M++)U+=`\nmr = onMapResponse[${M}](c)
				if(mr instanceof Promise) mr = await mr
				if(mr !== undefined) c.response = mr\n`;if(g0)U+="return mapResponse(r, c.set, c.request)\n";else U+="return mapCompactResponse(r, c.request)\n"}else{const O=E("handle",{name:_?B.name:void 0});if(Q.response||Z.mapResponse.length){if(U+=K0?`let r = await ${z};\n`:`let r = ${z};\n`,O(),Q.response)U+=H0();if(E("afterHandle")(),Z.mapResponse.length){U+="c.response = r";for(let w=0;w<Z.mapResponse.length;w++)U+=`\nif(mr === undefined) {
						mr = onMapResponse[${w}](c)
						if(mr instanceof Promise) mr = await mr
    					if(mr !== undefined) r = c.response = mr
					}\n`}if(U+=P,B instanceof Response)U+=D.set?`if(
					isNotEmpty(c.set.headers) ||
					c.set.status !== 200 ||
					c.set.redirect ||
					c.set.cookie
				)
					return mapResponse(${z}.clone(), c.set, c.request)
				else
					return ${z}.clone()`:`return ${z}.clone()`,U+="\n";else if(g0)U+="return mapResponse(r, c.set, c.request)\n";else U+="return mapCompactResponse(r, c.request)\n"}else if(j.handle||v){if(U+=K0?`let r = await ${z};\n`:`let r = ${z};\n`,O(),E("afterHandle")(),Z.mapResponse.length){U+="c.response = r";for(let w=0;w<Z.mapResponse.length;w++)U+=`\nif(mr === undefined) {
							mr = onMapResponse[${w}](c)
							if(mr instanceof Promise) mr = await mr
    						if(mr !== undefined) r = c.response = mr
						}\n`}if(U+=P,g0)U+="return mapResponse(r, c.set, c.request)\n";else U+="return mapCompactResponse(r, c.request)\n"}else{O();const w=K0?`await ${z}`:z;if(E("afterHandle")(),B instanceof Response)U+=D.set?`if(
					isNotEmpty(c.set.headers) ||
					c.set.status !== 200 ||
					c.set.redirect ||
					c.set.cookie
				)
					return mapResponse(${z}.clone(), c.set, c.request)
				else
					return ${z}.clone()`:`return ${z}.clone()`,U+="\n";else if(g0)U+=`return mapResponse(${w}, c.set, c.request)\n`;else U+=`return mapCompactResponse(${w}, c.request)\n`}}if(F||A){if(U+="\n} catch(error) {",!W1)U+="return (async () => {";U+="const set = c.set\nif (!set.status || set.status < 300) set.status = error?.status || 500\n";const O=E("error",{unit:Z.error.length});if(Z.error.length){U+=`
				c.error = error
				c.code = error.code ?? error[ERROR_CODE] ?? "UNKNOWN"
			`;for(let w=0;w<Z.error.length;w++){const M=`er${w}`,L=E("error.unit",{name:Z.error[w].fn.name});if(U+=`\nlet ${M} = handleErrors[${w}](c)\n`,x(Z.error[w]))U+=`if (${M} instanceof Promise) ${M} = await ${M}\n`;L(),U+=`${M} = mapEarlyResponse(${M}, set, c.request)\n`,U+=`if (${M}) {`,U+=`return ${M} }\n`}}if(O(),U+="return handleError(c, error, true)\n\n",!W1)U+="})()";if(U+="}",A||V){U+=" finally { ";const w=E("response",{unit:Z.onResponse.length});U+=A,w(),U+="}"}}return U=`const {
		handler,
		handleError,
		hooks: {
			transform,
			resolve,
			beforeHandle,
			afterHandle,
			mapResponse: onMapResponse,
			parse,
			error: handleErrors,
			onResponse
		},
		validator: {
			body,
			headers,
			params,
			query,
			response,
			cookie
		},
		utils: {
			mapResponse,
			mapCompactResponse,
			mapEarlyResponse,
			parseQuery,
			isNotEmpty
		},
		error: {
			NotFoundError,
			ValidationError,
			InternalServerError,
			ParseError
		},
		schema,
		definitions,
		ERROR_CODE,
		getReporter,
		requestId,
		parseCookie,
		signCookie,
		decodeURIComponent,
		ELYSIA_RESPONSE
	} = hooks

	${Z.onResponse.length?`const ${Z.onResponse.map((O,w)=>`res${w} = onResponse[${w}]`).join(",")}`:""}

	return ${W1?"async":""} function handle(c) {
		${Z.beforeHandle.length?"let be":""}
		${Z.afterHandle.length?"let af":""}
		${Z.mapResponse.length?"let mr":""}

		${Y?"c.schema = schema; c.defs = definitions":""}
		${U}
	}`,Function("hooks",U)({handler:B,hooks:a1(Z),validator:Q,handleError:$.handleError,utils:{mapResponse:u,mapCompactResponse:o,mapEarlyResponse:h,parseQuery:D$.parse,isNotEmpty:m},error:{NotFoundError:Y0,ValidationError:q,InternalServerError:r0,ParseError:o0},schema:$.router.history,definitions:$.definitions.type,ERROR_CODE:B0,getReporter:()=>$.reporter,requestId:w$,parseCookie:c0,signCookie:w0,decodeURIComponent:z$.default,ELYSIA_RESPONSE:d})},O1=($)=>{const W={event:{...$.inference.event,queries:[...$.inference.event.queries]},trace:{...$.inference.trace}};let J="",X="";const Z=$.setHeaders;for(let U of Object.keys($.singleton.decorator))J+=`,${U}: app.singleton.decorator.${U}`;const Q=$.router,B=$.event.trace.length>0;let Y=`
	const route = router.find(request.method, path) ${Q.http.root.ALL?'?? router.find("ALL", path)':""}

	if (route === null)
		return ${$.event.error.length?"app.handleError(ctx, notFound)":$.event.request.length?`new Response(error404Message, {
					status: ctx.set.status === 200 ? 404 : ctx.set.status,
					headers: ctx.set.headers
				})`:"error404.clone()"}

	ctx.params = route.params\n`;if(!($.config.precompile===!0||typeof $.config.precompile==="object"&&$.config.precompile.compose===!0))Y+=`
			if(route.store.composed)
				return route.store.composed(ctx)

			if(route.store.compose)
				return (route.store.compose())(ctx)`;else Y+="return route.store(ctx)";Y+="\n";let K="";for(let[U,{code:D,all:I}]of Object.entries(Q.static.http.map))K+=`case '${U}':\nswitch(request.method) {\n${D}\n${I??"default: break map"}}\n\n`;const _=$.event.request.some(x),F=`\n
	const url = request.url
	const s = url.indexOf('/', 11)
	const qi = url.indexOf('?', s + 1)
	let path
	if(qi === -1)
		path = url.substring(s)
	else
		path = url.substring(s, qi)\n`;if(X+=`const {
		app,
		mapEarlyResponse,
		NotFoundError,
		requestId,
		getReporter,
		handleError,
		error,
		redirect
	} = data

	const store = app.singleton.store
	const staticRouter = app.router.static.http
	const wsRouter = app.router.ws
	const router = app.router.http

	const notFound = new NotFoundError()

	${$.event.request.length?"const onRequest = app.event.request.map(x => x.fn)":""}
	${Q.static.http.variables}
	${$.event.error.length?"":`
	const error404Message = notFound.message.toString()
	const error404 = new Response(error404Message, { status: 404 });
	`}

	return ${_?"async":""} function map(request) {\n`,$.event.request.length)X+="let re";const z=M$({hasTrace:B,hasTraceSet:W.trace.set,condition:{request:W.trace.request},addFn:(U)=>{X+=U}});if($.event.request.length){X+=`
			${B?"const id = +requestId.value++":""}

			const ctx = {
				request,
				store,
				redirect,
				set: {
					headers: ${Object.keys(Z??{}).length?"Object.assign({}, app.setHeaders)":"{}"},
					status: 200
				},
				error
				${B?",$$requestId: +id":""}
				${J}
			}
		`;const U=z("request",{attribute:"ctx",unit:$.event.request.length});X+="\n try {\n";for(let D=0;D<$.event.request.length;D++){const I=$.event.request[D],N=R0(I.fn.toString()),R=x(I),T=z("request.unit",{name:$.event.request[D].fn.name});if(N)X+=`re = mapEarlyResponse(
					${R?"await":""} onRequest[${D}](ctx),
					ctx.set,
					request
				)\n`,T(),X+="if(re !== undefined) return re\n";else X+=`${R?"await":""} onRequest[${D}](ctx)\n`,T()}X+=`} catch (error) {
			return app.handleError(ctx, error)
		}`,U(),X+=F,X+="\nctx.qi = qi\n ctx.path = path\n"}else X+=F,X+=`${B?"const id = +requestId.value++":""}
		const ctx = {
			request,
			store,
			qi,
			path,
			redirect,
			set: {
				headers: ${Object.keys(Z??{}).length?"Object.assign({}, app.setHeaders)":"{}"},
				status: 200
			},
			error
			${B?",$$requestId: id":""}
			${J}
		}`,z("request",{unit:$.event.request.length,attribute:W.trace.context||W.trace.store||W.trace.set?"ctx":""})();const A=$.router.static.ws,j=$.router.ws;if(Object.keys(A).length||j.history.length){X+=`
			if(request.method === 'GET') {
				switch(path) {`;for(let[U,D]of Object.entries(A))X+=`
					case '${U}':
						if(request.headers.get('upgrade') === 'websocket')
							return st${D}(ctx)

						break`;X+=`
				default:
					if(request.headers.get('upgrade') === 'websocket') {
						const route = wsRouter.find('ws', path)

						if(route) {
							ctx.params = route.params

							return route.store(ctx)
						}
					}

					break
			}
		}\n`}X+=`
		map: switch(path) {
			${K}

			default:
				break
		}

		${Y}
	}`;const V=P1($);return $.handleError=V,Function("data",X)({app:$,mapEarlyResponse:h,NotFoundError:Y0,getReporter:()=>$.reporter,requestId:w$,handleError:V,error:M1,redirect:w1})},P1=($)=>{let W=`const {
		app: { event: { error: onErrorContainer, onResponse: resContainer } },
		mapResponse,
		ERROR_CODE,
		ELYSIA_RESPONSE
	} = inject

	const onError = onErrorContainer.map(x => x.fn)
	const res = resContainer.map(x => x.fn)

	return ${$.event.error.find(x)?"async":""} function(context, error, skipGlobal) {
		let r

		const { set } = context

		context.code = error.code
		context.error = error

		if(typeof error === "object" && ELYSIA_RESPONSE in error) {
			error.status = error[ELYSIA_RESPONSE]
			error.message = error.response
		}\n`;for(let J=0;J<$.event.error.length;J++){const X=$.event.error[J],Z=`${x(X)?"await ":""}onError[${J}](context)`;if(W+="\nif(skipGlobal !== true) {\n",R0(X.fn.toString()))W+=`r = ${Z}; if(r !== undefined) {
				if(r instanceof Response) return r

				if(r[ELYSIA_RESPONSE]) {
					error.status = error[ELYSIA_RESPONSE]
					error.message = error.response
				}

				if(set.status === 200) set.status = error.status
				return mapResponse(r, set, context.request)
			}\n`;else W+=Z+"\n";W+="\n}\n"}return W+=`if(error.constructor.name === "ValidationError" || error.constructor.name === "TransformDecodeError") {
		set.status = error.status ?? 422
		return new Response(
			error.message,
			{
				headers: Object.assign(
					{ 'content-type': 'application/json'},
					set.headers
				),
				status: set.status
			}
		)
	} else {
		if(error.code && typeof error.status === "number")
			return new Response(
				error.message,
				{ headers: set.headers, status: error.status }
			)

		return mapResponse(error, set, context.request)
	}
}`,Function("inject",W)({app:$,mapResponse:u,ERROR_CODE:B0,ELYSIA_RESPONSE:d})},E0=($)=>`if(stc${$}) return stc${$}(ctx)
if(st${$}.compose) return (stc${$} = st${$}.compose())(ctx)

return st${$}(ctx)`;var e0=I0(N1(),1);var V1=($)=>async(W)=>{const J=W.url,X=J.indexOf("/",11),Z=J.indexOf("?",X+1),Q=Z===-1?J.substring(X):J.substring(X,Z),B={cookie:{},status:200,headers:{}},Y=Object.assign({},$.singleton.decorator,{set:B,store:$.singleton.store,request:W,path:Q,qi:Z});try{for(let D=0;D<$.event.request.length;D++){const I=$.event.request[D].fn;let N=I(Y);if(N instanceof Promise)N=await N;if(N=h(N,B),N)return N}const G=$.router.dynamic.find(W.method,Q)??$.router.dynamic.find("ALL",Q);if(!G)throw new Y0;const{handle:K,hooks:_,validator:F,content:z}=G.store;let A;if(W.method!=="GET"&&W.method!=="HEAD")if(z)switch(z){case"application/json":A=await W.json();break;case"text/plain":A=await W.text();break;case"application/x-www-form-urlencoded":A=e0.parse(await W.text());break;case"application/octet-stream":A=await W.arrayBuffer();break;case"multipart/form-data":A={};const D=await W.formData();for(let I of D.keys()){if(A[I])continue;const N=D.getAll(I);if(N.length===1)A[I]=N[0];else A[I]=N}break}else{let D=W.headers.get("content-type");if(D){const I=D.indexOf(";");if(I!==-1)D=D.slice(0,I);Y.contentType=D;for(let N=0;N<_.parse.length;N++){const R=_.parse[N].fn;let T=R(Y,D);if(T instanceof Promise)T=await T;if(T){A=T;break}}if(delete Y.contentType,A===void 0)switch(D){case"application/json":A=await W.json();break;case"text/plain":A=await W.text();break;case"application/x-www-form-urlencoded":A=e0.parse(await W.text());break;case"application/octet-stream":A=await W.arrayBuffer();break;case"multipart/form-data":A={};const N=await W.formData();for(let R of N.keys()){if(A[R])continue;const T=N.getAll(R);if(T.length===1)A[R]=T[0];else A[R]=T}break}}}Y.body=A,Y.params=G?.params||void 0,Y.query=Z===-1?{}:e0.parse(J.substring(Z+1)),Y.headers={};for(let[D,I]of W.headers.entries())Y.headers[D]=I;const j=Object.assign({},$.config?.cookie,F?.cookie?.config),V=W.headers.get("cookie");Y.cookie=await c0(Y.set,V,j?{secrets:j.secrets!==void 0?typeof j.secrets==="string"?j.secrets:j.secrets.join(","):void 0,sign:j.sign===!0?!0:j.sign!==void 0?typeof j.sign==="string"?j.sign:j.sign.join(","):void 0}:void 0);for(let D=0;D<_.transform.length;D++){const I=_.transform[D],N=I.fn(Y);if(I.subType==="derive")if(N instanceof Promise)Object.assign(Y,await N);else Object.assign(Y,N);else if(N instanceof Promise)await N}if(F){if(F.headers){const D={};for(let I in W.headers)D[I]=W.headers.get(I);if(F.headers.Check(D)===!1)throw new q("header",F.headers,D)}if(F.params?.Check(Y.params)===!1)throw new q("params",F.params,Y.params);if(F.query?.Check(Y.query)===!1)throw new q("query",F.query,Y.query);if(F.cookie){const D={};for(let[I,N]of Object.entries(Y.cookie))D[I]=N.value;if(F.cookie?.Check(D)===!1)throw new q("cookie",F.cookie,D)}if(F.body?.Check(A)===!1)throw new q("body",F.body,A)}for(let D=0;D<_.beforeHandle.length;D++){let I=_.beforeHandle[D].fn(Y);if(I instanceof Promise)I=await I;if(I!==void 0){Y.response=I;for(let R=0;R<_.afterHandle.length;R++){let T=_.afterHandle[R].fn(Y);if(T instanceof Promise)T=await T;if(T)I=T}const N=h(I,Y.set);if(N)return N}}let U=K(Y);if(U instanceof Promise)U=await U;if(!_.afterHandle.length){const D=F?.response?.[U.status];if(D?.Check(U)===!1)throw new q("response",D,U)}else{Y.response=U;for(let D=0;D<_.afterHandle.length;D++){let I=_.afterHandle[D].fn(Y);if(I instanceof Promise)I=await I;const N=h(I,Y.set);if(N!==void 0){const R=F?.response?.[U.status];if(R?.Check(N)===!1)throw new q("response",R,N);return N}}}if(Y.set.cookie&&j?.sign){const D=!j.secrets?void 0:typeof j.secrets==="string"?j.secrets:j.secrets[0];if(j.sign===!0)for(let[I,N]of Object.entries(Y.set.cookie))Y.set.cookie[I].value=await w0(N.value,"${secret}");else{const I=F?.cookie?.schema?.properties;for(let N of j.sign){if(!(N in I))continue;if(Y.set.cookie[N]?.value)Y.set.cookie[N].value=await w0(Y.set.cookie[N].value,D)}}}return u(U,Y.set)}catch(G){if(G.status)B.status=G.status;return $.handleError(Y,G)}finally{for(let G of $.event.onResponse)await G.fn(Y)}},A$=($)=>async(W,J)=>{const X=Object.assign(W,{error:J,code:J.code});X.set=W.set;for(let Z=0;Z<$.event.error.length;Z++){let B=$.event.error[Z].fn(X);if(B instanceof Promise)B=await B;if(B!==void 0&&B!==null)return u(B,W.set)}return new Response(typeof J.cause==="string"?J.cause:J.message,{headers:W.set.headers,status:J.status??500})};import{TypeRegistry as V$} from"@sinclair/typebox";import{TypeSystem as N0} from"@sinclair/typebox/system";import{Type as b0,FormatRegistry as a} from"@sinclair/typebox";import{Value as j0} from"@sinclair/typebox/value";var z9=function($){return $%4===0&&($%100!==0||$%400===0)},O$=function($){const W=w9.exec($);if(!W)return!1;const J=+W[1],X=+W[2],Z=+W[3];return X>=1&&X<=12&&Z>=1&&Z<=(X===2&&z9(J)?29:M9[X])},S1=function($){return function W(J){const X=A9.exec(J);if(!X)return!1;const Z=+X[1],Q=+X[2],B=+X[3],Y=X[4],G=X[5]==="-"?-1:1,K=+(X[6]||0),_=+(X[7]||0);if(K>23||_>59||$&&!Y)return!1;if(Z<=23&&Q<=59&&B<60)return!0;const F=Q-_*G,z=Z-K*G-(F<0?1:0);return(z===23||z===-1)&&(F===59||F===-1)&&B<61}},j$=function($){const W=S1($);return function J(X){const Z=X.split(j9);return Z.length===2&&O$(Z[0])&&W(Z[1])}},O9=function($){return N9.test($)&&I9.test($)},P9=function($){return N$.lastIndex=0,N$.test($)},C9=function($){return Number.isInteger($)&&$<=S9&&$>=V9},T9=function($){return Number.isInteger($)},I$=function(){return!0},L9=function($){if(q9.test($))return!1;try{return new RegExp($),!0}catch(W){return!1}},$1={date:O$,time:S1(!0),"date-time":j$(!0),"iso-time":S1(!1),"iso-date-time":j$(!1),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:O9,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:L9,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:P9,int32:{type:"number",validate:C9},int64:{type:"number",validate:T9},float:{type:"number",validate:I$},double:{type:"number",validate:I$},password:!0,binary:!0},w9=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,M9=[0,31,28,31,30,31,30,31,31,30,31,30,31],A9=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i,j9=/t|\s/i,N9=/\/|:/,I9=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,N$=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm,V9=-2147483648,S9=2147483647,q9=/[^\\]\\Z/;import{TypeSystemPolicy as n6,TypeSystem as r6,TypeSystemDuplicateFormat as o6,TypeSystemDuplicateTypeKind as a6} from"@sinclair/typebox/system";import{TypeCompiler as $8,TypeCheck as W8} from"@sinclair/typebox/compiler";var S$=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,C$=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,T$=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,R9=$1.date,E9=$1["date-time"];if(!a.Has("date"))N0.Format("date",($)=>{const W=$.replace(/"/g,"");if(S$.test(W)||C$.test(W)||T$.test(W)||R9(W)){const J=new Date(W);if(!Number.isNaN(J.getTime()))return!0}return!1});if(!a.Has("date-time"))N0.Format("date-time",($)=>{const W=$.replace(/"/g,"");if(S$.test(W)||C$.test(W)||T$.test(W)||E9(W)){const J=new Date(W);if(!Number.isNaN(J.getTime()))return!0}return!1});Object.entries($1).forEach(($)=>{const[W,J]=$;if(!a.Has(W)){if(J instanceof RegExp)N0.Format(W,(X)=>J.test(X));else if(typeof J==="function")N0.Format(W,J)}});var C=Object.assign({},b0),P$=($)=>{if(typeof $==="string")switch($.slice(-1)){case"k":return+$.slice(0,$.length-1)*1024;case"m":return+$.slice(0,$.length-1)*1048576;default:return+$}return $},C1=($,W)=>{if(!(W instanceof Blob))return!1;if($.minSize&&W.size<P$($.minSize))return!1;if($.maxSize&&W.size>P$($.maxSize))return!1;if($.extension)if(typeof $.extension==="string"){if(!W.type.startsWith($.extension))return!1}else{for(let J=0;J<$.extension.length;J++)if(W.type.startsWith($.extension[J]))return!0;return!1}return!0},b9=V$.Get("Files")??N0.Type("File",C1),H9=V$.Get("Files")??N0.Type("Files",($,W)=>{if(!Array.isArray(W))return C1($,W);if($.minItems&&W.length<$.minItems)return!1;if($.maxItems&&W.length>$.maxItems)return!1;for(let J=0;J<W.length;J++)if(!C1($,W[J]))return!1;return!0});if(!a.Has("numeric"))a.Set("numeric",($)=>!!$&&!isNaN(+$));if(!a.Has("boolean"))a.Set("boolean",($)=>$==="true"||$==="false");if(!a.Has("ObjectString"))a.Set("ObjectString",($)=>{let W=$.charCodeAt(0);if(W===9||W===10||W===32)W=$.trimStart().charCodeAt(0);if(W!==123&&W!==91)return!1;try{return JSON.parse($),!0}catch{return!1}});var e={Numeric:($)=>{const W=b0.Number($);return C.Transform(C.Union([C.String({format:"numeric",default:0}),C.Number($)],$)).Decode((J)=>{const X=+J;if(isNaN(X))return J;if($&&!j0.Check(W,X))throw new q("property",W,X);return X}).Encode((J)=>J)},Date:($)=>{const W=b0.Date($);return C.Transform(C.Union([b0.Date($),C.String({format:"date",default:(new Date()).toISOString()}),C.String({format:"date-time",default:(new Date()).toISOString()})],$)).Decode((J)=>{if(J instanceof Date)return J;const X=new Date(J);if(!j0.Check(W,X))throw new q("property",W,X);return X}).Encode((J)=>{if(typeof J==="string")return new Date(J);return J})},BooleanString:($)=>{const W=b0.Boolean($);return C.Transform(C.Union([C.String({format:"boolean",default:!1}),C.Boolean($)],$)).Decode((J)=>{if(typeof J==="string")return J==="true";if($&&!j0.Check(W,J))throw new q("property",W,J);return J}).Encode((J)=>J)},ObjectString:($={},W)=>{const J=C.Object($,W),X=JSON.stringify(j0.Create(J));return C.Transform(C.Union([C.String({format:"ObjectString",default:X}),J])).Decode((Z)=>{if(typeof Z==="string"){try{Z=JSON.parse(Z)}catch{throw new q("property",J,Z)}if(!j0.Check(J,Z))throw new q("property",J,Z);return Z}return Z}).Encode((Z)=>{if(typeof Z==="string")try{Z=JSON.parse(Z)}catch{throw new q("property",J,Z)}if(!j0.Check(J,Z))throw new q("property",J,Z);return JSON.stringify(Z)})},File:b9,Files:($={})=>C.Transform(H9($)).Decode((W)=>{if(Array.isArray(W))return W;return[W]}).Encode((W)=>W),Nullable:($)=>C.Union([C.Null(),$]),MaybeEmpty:($)=>C.Union([C.Null(),C.Undefined(),$]),Cookie:($,{domain:W,expires:J,httpOnly:X,maxAge:Z,path:Q,priority:B,sameSite:Y,secure:G,secrets:K,sign:_,...F}={})=>{const z=C.Object($,F);return z.config={domain:W,expires:J,httpOnly:X,maxAge:Z,path:Q,priority:B,sameSite:Y,secure:G,secrets:K,sign:_},z}};C.BooleanString=e.BooleanString;C.ObjectString=e.ObjectString;C.Numeric=e.Numeric;C.File=($={})=>e.File({default:"File",...$,extension:$?.type,type:"string",format:"binary"});C.Files=($={})=>e.Files({...$,elysiaMeta:"Files",default:"Files",extension:$?.type,type:"array",items:{...$,default:"Files",type:"string",format:"binary"}});C.Nullable=($)=>e.Nullable($);C.MaybeEmpty=e.MaybeEmpty;C.Cookie=e.Cookie;C.Date=e.Date;class i{config;server=null;dependencies={};reporter=new H1;_routes={};_types={Prefix:"",Scoped:!1,Singleton:{},Definitions:{},Metadata:{}};_ephemeral={};_volatile={};singleton={decorator:{},store:{},derive:{},resolve:{}};get store(){return this.singleton.store}get decorator(){return this.singleton.decorator}get _scoped(){return this.config.scoped}definitions={type:{},error:{}};extender={macros:[]};validator=null;event={start:[],request:[],parse:[],transform:[],beforeHandle:[],afterHandle:[],mapResponse:[],onResponse:[],trace:[],error:[],stop:[]};telemetry={stack:void 0};router={http:new X0,ws:new X0,dynamic:new X0,static:{http:{handlers:[],variables:"",map:{},all:""},ws:{}},history:[]};inference={event:{body:!1,cookie:!1,headers:!1,queries:[],query:!1,set:!1,unknownQueries:!1},trace:{request:!1,parse:!1,transform:!1,handle:!1,beforeHandle:!1,afterHandle:!1,error:!1,context:!1,store:!1,set:!1}};promisedModules=new z1;constructor($){if($?.tags)if(!$.detail)$.detail={tags:$.tags};else $.detail.tags=$.tags;if(this.config={forceErrorEncapsulation:!0,prefix:"",aot:!0,strictPath:!1,global:!1,cookie:{},analytic:!1,...$,experimental:$?.experimental??{},seed:$?.seed===void 0?"":$?.seed},$?.analytic&&($?.name||$?.seed!==void 0))this.telemetry.stack=new Error().stack}getServer(){return this.server}get routes(){return this.router.history}routeTree=new Map;applyMacro($){if(this.extender.macros.length){const W=r1({globalHook:this.event,localHook:$}),J={events:{global:this.event,local:$},onParse:W("parse"),onTransform:W("transform"),onBeforeHandle:W("beforeHandle"),onAfterHandle:W("afterHandle"),onResponse:W("onResponse"),mapResponse:W("mapResponse"),onError:W("error")};for(let X of this.extender.macros)D1(X.fn(J),$)}}add($,W,J,X,{allowMeta:Z=!1,skipPrefix:Q=!1}={allowMeta:!1,skipPrefix:!1}){if(X=o1(X),W!==""&&W.charCodeAt(0)!==47)W="/"+W;if(this.config.prefix&&!Q&&!this.config.scoped)W=this.config.prefix+W;if(X?.type)switch(X.type){case"text":X.type="text/plain";break;case"json":X.type="application/json";break;case"formdata":X.type="multipart/form-data";break;case"urlencoded":X.type="application/x-www-form-urlencoded";break;case"arrayBuffer":X.type="application/octet-stream";break;default:break}const B=this.definitions.type;let Y,G,K,_,F,z;const A=!this.config.aot,j={body:X?.body??this.validator?.body,headers:X?.headers??this.validator?.headers,params:X?.params??this.validator?.params,query:X?.query??this.validator?.query,cookie:X?.cookie??this.validator?.cookie,response:X?.response??this.validator?.response},V=()=>j.cookie?l0({validator:j.cookie,defaultConfig:this.config.cookie,config:j.cookie?.config??{},dynamic:A,models:B}):void 0,U=this.config.normalize,D=this.config.precompile===!0||typeof this.config.precompile==="object"&&this.config.precompile.schema===!0?{body:k(j.body,{dynamic:A,models:B,normalize:U}),headers:k(j.headers,{dynamic:A,models:B,additionalProperties:!0}),params:k(j.params,{dynamic:A,models:B}),query:k(j.query,{dynamic:A,models:B,normalize:U}),cookie:V(),response:p0(j.response,{dynamic:A,models:B,normalize:U})}:{get body(){if(Y)return Y;return Y=k(j.body,{dynamic:A,models:B,normalize:U})},get headers(){if(G)return G;return k(j.headers,{dynamic:A,models:B,additionalProperties:!0})},get params(){if(K)return K;return K=k(j.params,{dynamic:A,models:B})},get query(){if(_)return _;return _=k(j.query,{dynamic:A,models:B})},get cookie(){if(F)return F;return F=V()},get response(){if(z)return z;return z=p0(j.response,{dynamic:A,models:B,normalize:U})}},I=W.endsWith("/")?W.slice(0,W.length-1):W+"/";if(X=f(X,{},{allowMacro:!0}),X.tags)if(!X.detail)X.detail={tags:X.tags};else X.detail.tags=X.tags;if(m(this.config.detail))X.detail=p(Object.assign({},this.config.detail),X.detail);this.applyMacro(X);const N=f(this.event,X);if(this.config.aot===!1){if(this.router.dynamic.add($,W,{validator:D,hooks:N,content:X?.type,handle:J}),this.config.strictPath===!1)this.router.dynamic.add($,I,{validator:D,hooks:N,content:X?.type,handle:J});this.router.history.push({method:$,path:W,composed:null,handler:J,hooks:N});return}let R=void 0;const T=this.config.precompile===!0||typeof this.config.precompile==="object"&&this.config.precompile.compose===!0,$0=t0(this.inference),v=T?a0({app:this,path:W,method:$,localHook:f(X),hooks:N,validator:D,handler:J,allowMeta:Z,appInference:$0}):(P)=>{if(R)return R(P);return(R=a0({app:this,path:W,method:$,localHook:f(X),hooks:N,validator:D,handler:J,allowMeta:Z,appInference:$0}))(P)};if(!T)v.compose=()=>{return v.composed=a0({app:this,path:W,method:$,localHook:f(X),hooks:N,validator:D,handler:J,allowMeta:Z,appInference:$0})};let n=this.router.history.length;if(this.routeTree.has($+W)){if(n=this.router.history.findIndex((P)=>P.path===W&&P.method===$),n!==-1){const P=this.router.history.splice(n,1)[0];if(P&&this.routeTree.has(P?.method+P?.path))this.routeTree.delete(P.method+P.path)}}this.routeTree.set($+W,n),this.router.history.push({method:$,path:W,composed:v,handler:J,hooks:N});const S=this.router.static.http;if($==="$INTERNALWS"){const P=this.config.strictPath?void 0:W.endsWith("/")?W.slice(0,W.length-1):W+"/";if(W.indexOf(":")===-1&&W.indexOf("*")===-1){const W0=S.handlers.length;if(S.handlers.push(v),S.variables+=`const st${W0} = staticRouter.handlers[${W0}]\n`,this.router.static.ws[W]=W0,P)this.router.static.ws[P]=W0}else if(this.router.ws.add("ws",W,v),P)this.router.ws.add("ws",P,v);return}if(W.indexOf(":")===-1&&W.indexOf("*")===-1){const P=S.handlers.length;if(S.handlers.push(v),S.variables+=T?`const st${P} = staticRouter.handlers[${P}]\n`:`let st${P} = staticRouter.handlers[${P}]\nlet stc${P}\n`,!S.map[W])S.map[W]={code:""};if($==="ALL")S.map[W].all=T?`default: return st${P}(ctx)\n`:`default: ${E0(P)}\n`;else S.map[W].code=T?`case '${$}': return st${P}(ctx)\n${S.map[W].code}`:`case '${$}': ${E0(P)}\n${S.map[W].code}`;if(!this.config.strictPath){if(!S.map[I])S.map[I]={code:""};if($==="ALL")S.map[I].all=T?`default: return st${P}(ctx)\n`:`default: ${E0(P)}\n`;else S.map[I].code=T?`case '${$}': return st${P}(ctx)\n${S.map[I].code}`:`case '${$}': ${E0(P)}\n${S.map[I].code}`}}else if(this.router.http.add($,W,v),!this.config.strictPath)this.router.http.add($,W.endsWith("/")?W.slice(0,W.length-1):W+"/",v)}setHeaders;headers($){if(!$)return this;if(!this.setHeaders)this.setHeaders={};return this.setHeaders=p(this.setHeaders,$),this}onStart($){return this.on("start",$),this}onRequest($){return this.on("request",$),this}onParse($,W){if(!W)return this.on("parse",$);return this.on($,"parse",W)}onTransform($,W){if(!W)return this.on("transform",$);return this.on($,"transform",W)}resolve($,W){if(!W)W=$,$={as:"local"};const J={subType:"resolve",fn:W};return this.onBeforeHandle($,J)}mapResolve($,W){if(!W)W=$,$={as:"local"};const J={subType:"resolve",fn:W};return this.onBeforeHandle($,J)}onBeforeHandle($,W){if(!W)return this.on("beforeHandle",$);return this.on($,"beforeHandle",W)}onAfterHandle($,W){if(!W)return this.on("afterHandle",$);return this.on($,"afterHandle",W)}mapResponse($,W){if(!W)return this.on("mapResponse",$);return this.on($,"mapResponse",W)}onResponse($,W){if(!W)return this.on("response",$);return this.on($,"response",W)}trace($,W){if(!W)W=$,$={as:"local"};if(!Array.isArray(W))W=[W];for(let J of W)this.reporter.on("event",x1(()=>this.reporter,this.event.trace.length,J));return this.on($,"trace",W),this}error($,W){switch(typeof $){case"string":return W.prototype[B0]=$,this.definitions.error[$]=W,this;case"function":return this.definitions.error=$(this.definitions.error),this}for(let[J,X]of Object.entries($))X.prototype[B0]=J,this.definitions.error[J]=X;return this}onError($,W){if(!W)return this.on("error",$);return this.on($,"error",W)}onStop($){return this.on("stop",$),this}on($,W,J){let X;switch(typeof $){case"string":X=$,J=W;break;case"object":X=W;break}if(X==="response")X="onResponse";if(Array.isArray(J))J=c(J);else if(typeof J==="function")J=[{fn:J}];else J=[J];const Z=J;for(let Q of Z)Q.scope=typeof $==="string"?"local":$?.as??"local";if(X==="trace")h1(Z.map((Q)=>Q.fn),this.inference.trace);else u0({[X]:Z.map((Q)=>Q.fn)},this.inference.event);for(let Q of Z){const B=n1(Q,"global",{skipIfHasType:!0});switch(X){case"start":this.event.start.push(B);break;case"request":this.event.request.push(B);break;case"parse":this.event.parse.push(B);break;case"transform":this.event.transform.push(B);break;case"beforeHandle":this.event.beforeHandle.push(B);break;case"afterHandle":this.event.afterHandle.push(B);break;case"mapResponse":this.event.mapResponse.push(B);break;case"onResponse":this.event.onResponse.push(B);break;case"trace":this.event.trace.push(B);break;case"error":this.event.error.push(B);break;case"stop":this.event.stop.push(B);break}}return this}propagate(){const $=(W)=>{for(let J of W)if("scope"in J&&J.scope==="local")J.scope="scoped"};return $(this.event.parse),$(this.event.transform),$(this.event.beforeHandle),$(this.event.afterHandle),$(this.event.mapResponse),$(this.event.onResponse),$(this.event.trace),$(this.event.error),this}group($,W,J){const X=new i({...this.config,prefix:""});X.singleton={...this.singleton},X.definitions={...this.definitions},X.getServer=()=>this.server,X.inference=t0(this.inference);const Z=typeof W==="object",Q=(Z?J:W)(X);if(this.singleton=p(this.singleton,X.singleton),this.definitions=p(this.definitions,X.definitions),Q.event.request.length)this.event.request=[...this.event.request||[],...Q.event.request||[]];if(Q.event.onResponse.length)this.event.onResponse=[...this.event.onResponse||[],...Q.event.onResponse||[]];return this.model(Q.definitions.type),Object.values(X.router.history).forEach(({method:B,path:Y,handler:G,hooks:K})=>{if(Y=(Z?"":this.config.prefix)+$+Y,Z){const _=W,F=K;this.add(B,Y,G,f(_,{...F||{},error:!F.error?Q.event.error:Array.isArray(F.error)?[...F.error||{},...Q.event.error||{}]:[F.error,...Q.event.error||{}]}))}else this.add(B,Y,G,f(K,{error:Q.event.error}),{skipPrefix:!0})}),this}guard($,W){if(!W){if(typeof $==="object"){if(this.applyMacro($),this.event=i0(this.event,$),this.validator={body:$.body??this.validator?.body,headers:$.headers??this.validator?.headers,params:$.params??this.validator?.params,query:$.query??this.validator?.query,response:$.response??this.validator?.response,cookie:$.cookie??this.validator?.cookie},$.detail)if(this.config.detail)this.config.detail=p(Object.assign({},this.config.detail),$.detail);else this.config.detail=$.detail;if($?.tags)if(!this.config.detail)this.config.detail={tags:$.tags};else this.config.detail.tags=$.tags;return this}return this.guard({},$)}const J=new i({...this.config,prefix:""});J.singleton={...this.singleton},J.definitions={...this.definitions},J.inference=t0(this.inference);const X=W(J);if(this.singleton=p(this.singleton,J.singleton),this.definitions=p(this.definitions,J.definitions),X.getServer=()=>this.server,X.event.request.length)this.event.request=[...this.event.request||[],...X.event.request||[]];if(X.event.onResponse.length)this.event.onResponse=[...this.event.onResponse||[],...X.event.onResponse||[]];return this.model(X.definitions.type),Object.values(J.router.history).forEach(({method:Z,path:Q,handler:B,hooks:Y})=>{this.add(Z,Q,B,f($,{...Y||{},error:!Y.error?X.event.error:Array.isArray(Y.error)?[...Y.error||{},...X.event.error||[]]:[Y.error,...X.event.error||[]]},{allowMacro:!0}))}),this}use($,W){if(W?.scoped)return this.guard({},(J)=>J.use($));if(Array.isArray($)){let J=this;for(let X of $)J=this.use(X);return J}if($ instanceof Promise)return this.promisedModules.add($.then((J)=>{if(typeof J==="function")return J(this);if(J instanceof i)return this._use(J);if(typeof J.default==="function")return J.default(this);if(J.default instanceof i)return this._use(J.default);throw new Error('Invalid plugin type. Expected Elysia instance, function, or module with "default" as Elysia instance or function that returns Elysia instance.')}).then((J)=>J.compile())),this;return this._use($)}_use($){if(typeof $==="function"){const Z=$(this);if(Z instanceof Promise)return this.promisedModules.add(Z.then((Q)=>{if(Q instanceof i){this.compile();for(let{method:B,path:Y,handler:G,hooks:K}of Object.values(Q.router.history))this.add(B,Y,G,f(K,{error:Q.event.error}));return Q}if(typeof Q==="function")return Q(this);if(typeof Q.default==="function")return Q.default(this);return this._use(Q)}).then((Q)=>Q.compile())),this;return Z}if($.promisedModules.size)return this.promisedModules.add($.modules.then(()=>this._use($)).then((Z)=>Z.compile())),this;const{name:W,seed:J}=$.config;$.getServer=()=>this.getServer(),$.model(this.definitions.type),$.error(this.definitions.error);const X=$.config.scoped;if(X){if(W){if(!(W in this.dependencies))this.dependencies[W]=[];const Q=J!==void 0?C0(W+JSON.stringify(J)):0;if(this.dependencies[W].some(({checksum:B})=>Q===B))return this;this.dependencies[W].push(!this.config?.analytic?{name:$.config.name,seed:$.config.seed,checksum:Q,dependencies:$.dependencies}:{name:$.config.name,seed:$.config.seed,checksum:Q,dependencies:$.dependencies,stack:$.telemetry.stack,routes:$.router.history,decorators:$.singleton.decorator,store:$.singleton.store,type:$.definitions.type,error:$.definitions.error,derive:$.event.transform.filter((B)=>B.subType==="derive").map((B)=>({fn:B.fn.toString(),stack:new Error().stack??""})),resolve:$.event.transform.filter((B)=>B.subType==="derive").map((B)=>({fn:B.fn.toString(),stack:new Error().stack??""}))})}$.extender.macros=this.extender.macros.concat($.extender.macros);const Z=[];for(let Q=0;Q<$.extender.macros.length;Q++){const B=this.extender.macros[Q];if(Z.includes(B.checksum))$.extender.macros.splice(Q,1),Q--;Z.push(B.checksum)}if($.onRequest((Q)=>{Object.assign(Q,this.singleton.decorator),Object.assign(Q.store,this.singleton.store)}),$.event.trace.length)$.event.trace.push(...$.event.trace);if(!$.config.prefix)console.warn("It's recommended to use scoped instance with a prefix to prevent collision routing with other instance.");if($.event.error.length)$.event.error.push(...this.event.error);if($.config.aot)$.compile();if(X===!0&&$.config.prefix){this.mount($.config.prefix+"/",$.fetch);for(let Q of $.router.history)this.routeTree.set(Q.method+`${$.config.prefix}${Q.path}`,this.router.history.length),this.router.history.push({...Q,path:`${$.config.prefix}${Q.path}`,hooks:f(Q.hooks,{error:this.event.error})})}else{this.mount($.fetch);for(let Q of $.router.history)this.routeTree.set(Q.method+`${$.config.prefix}${Q.path}`,this.router.history.length),this.router.history.push({...Q,path:`${$.config.prefix}${Q.path}`,hooks:f(Q.hooks,{error:this.event.error})})}return this}else{this.headers($.setHeaders),$.reporter=this.reporter;for(let Q of $.event.trace)if(Q.scope&&Q.scope!=="local")this.trace(Q);if(W){if(!(W in this.dependencies))this.dependencies[W]=[];const Q=J!==void 0?C0(W+JSON.stringify(J)):0;if(!this.dependencies[W].some(({checksum:B})=>Q===B))this.extender.macros=this.extender.macros.concat($.extender.macros)}else this.extender.macros=this.extender.macros.concat($.extender.macros);const Z=[];for(let Q=0;Q<this.extender.macros.length;Q++){const B=this.extender.macros[Q];if(B.checksum){if(Z.includes(B.checksum))this.extender.macros.splice(Q,1),Q--;Z.push(B.checksum)}}this.inference={event:{body:this.inference.event.body||$.inference.event.body,cookie:this.inference.event.cookie||$.inference.event.cookie,headers:this.inference.event.headers||$.inference.event.headers,queries:[...this.inference.event.queries,...$.inference.event.queries],query:this.inference.event.query||$.inference.event.query,set:this.inference.event.set||$.inference.event.set,unknownQueries:this.inference.event.unknownQueries||$.inference.event.unknownQueries},trace:{request:this.inference.trace.request||$.inference.trace.request,parse:this.inference.trace.parse||$.inference.trace.parse,transform:this.inference.trace.transform||$.inference.trace.transform,handle:this.inference.trace.handle||$.inference.trace.handle,beforeHandle:this.inference.trace.beforeHandle||$.inference.trace.beforeHandle,afterHandle:this.inference.trace.afterHandle||$.inference.trace.afterHandle,error:this.inference.trace.error||$.inference.trace.error,context:this.inference.trace.context||$.inference.trace.context,store:this.inference.trace.store||$.inference.trace.store,set:this.inference.trace.set||$.inference.trace.set}}}this.decorate($.singleton.decorator),this.state($.singleton.store),this.model($.definitions.type),this.error($.definitions.error);for(let{method:Z,path:Q,handler:B,hooks:Y}of Object.values($.router.history))this.add(Z,Q,B,f(Y,{error:$.event.error}));if(!X)if(W){if(!(W in this.dependencies))this.dependencies[W]=[];const Z=J!==void 0?C0(W+JSON.stringify(J)):0;if(this.dependencies[W].some(({checksum:Q})=>Z===Q))return this;this.dependencies[W].push(!this.config?.analytic?{name:$.config.name,seed:$.config.seed,checksum:Z,dependencies:$.dependencies}:{name:$.config.name,seed:$.config.seed,checksum:Z,dependencies:$.dependencies,stack:$.telemetry.stack,routes:$.router.history,decorators:$.singleton,store:$.singleton.store,type:$.definitions.type,error:$.definitions.error,derive:$.event.transform.filter((Q)=>Q?.subType==="derive").map((Q)=>({fn:Q.toString(),stack:new Error().stack??""})),resolve:$.event.transform.filter((Q)=>Q?.subType==="resolve").map((Q)=>({fn:Q.toString(),stack:new Error().stack??""}))}),this.event=i0(this.event,F1($.event),Z)}else this.event=i0(this.event,F1($.event));return this}macro($){const W={checksum:C0(JSON.stringify({name:this.config.name,seed:this.config.seed,content:$.toString()})),fn:$};return this.extender.macros.push(W),this}mount($,W){if($ instanceof i||typeof $==="function"||$.length===0||$==="/"){const Z=typeof $==="function"?$:$ instanceof i?$.compile().fetch:W instanceof i?W.compile().fetch:W,Q=async({request:B,path:Y})=>Z(new Request(_1(B.url,Y||"/"),B));return this.all("/*",Q,{type:"none"}),this}const J=$.length;if(W instanceof i)W=W.compile().fetch;const X=async({request:Z,path:Q})=>W(new Request(_1(Z.url,Q.slice(J)||"/"),Z));return this.all($,X,{type:"none"}),this.all($+($.endsWith("/")?"*":"/*"),X,{type:"none"}),this}get($,W,J){return this.add("GET",$,W,J),this}post($,W,J){return this.add("POST",$,W,J),this}put($,W,J){return this.add("PUT",$,W,J),this}patch($,W,J){return this.add("PATCH",$,W,J),this}delete($,W,J){return this.add("DELETE",$,W,J),this}options($,W,J){return this.add("OPTIONS",$,W,J),this}all($,W,J){return this.add("ALL",$,W,J),this}head($,W,J){return this.add("HEAD",$,W,J),this}connect($,W,J){return this.add("CONNECT",$,W,J),this}route($,W,J,X){return this.add($.toUpperCase(),W,J,X,X?.config),this}ws($,W){const J=W.transformMessage?Array.isArray(W.transformMessage)?W.transformMessage:[W.transformMessage]:void 0;let X=null;const Z=k(W?.body,{models:this.definitions.type,normalize:this.config.normalize}),Q=k(W?.response,{models:this.definitions.type,normalize:this.config.normalize}),B=(Y)=>{if(typeof Y==="string"){const G=Y?.charCodeAt(0);if(G===47||G===123)try{Y=JSON.parse(Y)}catch{}else if(D0(Y))Y=+Y}if(J?.length)for(let G=0;G<J.length;G++){const K=J[G](Y);if(K!==void 0)Y=K}return Y};return this.route("$INTERNALWS",$,(Y)=>{const{set:G,path:K,qi:_,headers:F,query:z,params:A}=Y;if(X===null)X=this.getServer();if(X?.upgrade(Y.request,{headers:typeof W.upgrade==="function"?W.upgrade(Y):W.upgrade,data:{validator:Q,open(j){W.open?.(new M0(j,Y))},message:(j,V)=>{const U=B(V);if(Z?.Check(U)===!1)return void j.send(new q("message",Z,U).message);W.message?.(new M0(j,Y),U)},drain(j){W.drain?.(new M0(j,Y))},close(j,V,U){W.close?.(new M0(j,Y),V,U)}}}))return;return G.status=400,"Expected a websocket connection"},{beforeHandle:W.beforeHandle,transform:W.transform,headers:W.headers,params:W.params,query:W.query}),this}state($,W){switch(typeof $){case"object":return this.singleton.store=p(this.singleton.store,$),this;case"function":return this.singleton.store=$(this.singleton.store),this}if(!($ in this.singleton.store))this.singleton.store[$]=W;return this}decorate($,W){switch(typeof $){case"object":return this.singleton.decorator=p(this.singleton.decorator,$),this;case"function":return this.singleton.decorator=$(this.singleton.decorator),this}if(!($ in this.singleton.decorator))this.singleton.decorator[$]=W;return this}derive($,W){if(!W)W=$,$={as:"local"};const J={subType:"derive",fn:W};return this.onTransform($,J)}model($,W){switch(typeof $){case"object":return Object.entries($).forEach(([J,X])=>{if(!(J in this.definitions.type))this.definitions.type[J]=X}),this;case"function":return this.definitions.type=$(this.definitions.type),this}return this.definitions.type[$]=W,this}mapDerive($,W){if(!W)W=$,$={as:"local"};const J={subType:"derive",fn:W};return this.onTransform($,J)}affix($,W,J){if(J==="")return this;const X=["_","-"," "],Z=(G)=>G[0].toUpperCase()+G.slice(1),Q=$==="prefix"?(G,K)=>X.includes(G.at(-1)??"")?G+K:G+Z(K):X.includes(J.at(-1)??"")?(G,K)=>K+G:(G,K)=>K+Z(G),B=(G)=>{const K={};switch(G){case"decorator":for(let _ in this.singleton.decorator)K[Q(J,_)]=this.singleton.decorator[_];this.singleton.decorator=K;break;case"state":for(let _ in this.singleton.store)K[Q(J,_)]=this.singleton.store[_];this.singleton.store=K;break;case"model":for(let _ in this.definitions.type)K[Q(J,_)]=this.definitions.type[_];this.definitions.type=K;break;case"error":for(let _ in this.definitions.error)K[Q(J,_)]=this.definitions.error[_];this.definitions.error=K;break}},Y=Array.isArray(W)?W:[W];for(let G of Y.some((K)=>K==="all")?["decorator","state","model","error"]:Y)B(G);return this}prefix($,W){return this.affix("prefix",$,W)}suffix($,W){return this.affix("suffix",$,W)}compile(){if(this.fetch=this.config.aot?O1(this):V1(this),typeof this.server?.reload==="function")this.server.reload({...this.server||{},fetch:this.fetch});return this}handle=async($)=>this.fetch($);fetch=($)=>{return(this.fetch=this.config.aot?O1(this):V1(this))($)};handleError=async($,W)=>(this.handleError=this.config.aot?P1(this):A$(this))($,W);outerErrorHandler=($)=>new Response($.message||$.name||"Error",{status:$?.status??500});listen=($,W)=>{if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only. If you are running Elysia in other environment please use a dedicated plugin or export the handler via Elysia.fetch");if(this.compile(),typeof $==="string"){if(!D0($))throw new Error("Port must be a numeric value");$=parseInt($)}const J=this.fetch,X=typeof $==="object"?{development:!T0,reusePort:!0,...this.config.serve||{},...$||{},websocket:{...this.config.websocket||{},...A1||{}},fetch:J,error:this.outerErrorHandler}:{development:!T0,reusePort:!0,...this.config.serve||{},websocket:{...this.config.websocket||{},...A1||{}},port:$,fetch:J,error:this.outerErrorHandler};this.server=Bun?.serve(X);for(let Z=0;Z<this.event.start.length;Z++)this.event.start[Z].fn(this);if(W)W(this.server);return process.on("beforeExit",()=>{if(this.server){this.server.stop(),this.server=null;for(let Z=0;Z<this.event.stop.length;Z++)this.event.stop[Z].fn(this)}}),this.promisedModules.then(()=>{Bun?.gc(!1)}),this};stop=async()=>{if(!this.server)throw new Error("Elysia isn't running. Call `app.listen` to start the server.");if(this.server){if(this.server.stop(),this.server=null,this.event.stop.length)for(let $=0;$<this.event.stop.length;$++)this.event.stop[$].fn(this)}};get modules(){return Promise.all(this.promisedModules.promises)}}export{C as t,w1 as redirect,b as mergeObjectArray,f as mergeHook,u as mapResponse,h as mapEarlyResponse,o as mapCompactResponse,k as getSchemaValidator,p0 as getResponseSchemaValidator,M1 as error,i as default,q as ValidationError,Z0 as StatusMap,o0 as ParseError,Y0 as NotFoundError,s0 as InvertedStatusMap,P0 as InvalidCookieSignature,r0 as InternalServerError,i as Elysia,B0 as ERROR_CODE,d as ELYSIA_RESPONSE,r as Cookie};

//# debugId=17CE3FCF910F72FE64756e2164756e21
