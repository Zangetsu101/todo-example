"use strict";var Eden=(()=>{var q=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var ne=Object.prototype.hasOwnProperty;var re=(t,e)=>{for(var n in e)q(t,n,{get:e[n],enumerable:!0})},se=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of te(e))!ne.call(t,i)&&i!==n&&q(t,i,{get:()=>e[i],enumerable:!(r=ee(e,i))||r.enumerable});return t};var ae=t=>se(q({},"__esModule",{value:!0}),t);var le={};re(le,{edenFetch:()=>Y,edenTreaty:()=>X,treaty:()=>V});var _=(t,e,n)=>{if(t.endsWith("/")||(t+="/"),e==="index"&&(e=""),!n||!Object.keys(n).length)return`${t}${e}`;let r="";for(let[i,s]of Object.entries(n))r+=`${i}=${s}&`;return`${t}${e}?${r.slice(0,-1)}`},L=t=>t.trim().length!==0&&!Number.isNaN(Number(t));var T=class extends Error{constructor(n,r){super(r+"");this.status=n;this.value=r}};var I=class{constructor(e){this.url=e;this.ws=new WebSocket(e)}ws;send(e){return Array.isArray(e)?(e.forEach(n=>this.send(n)),this):(this.ws.send(typeof e=="object"?JSON.stringify(e):e.toString()),this)}on(e,n,r){return this.addEventListener(e,n,r)}off(e,n,r){return this.ws.removeEventListener(e,n,r),this}subscribe(e,n){return this.addEventListener("message",e,n)}addEventListener(e,n,r){return this.ws.addEventListener(e,i=>{if(e==="message"){let s=i.data.toString(),a=s.charCodeAt(0);if(a===47||a===123)try{s=JSON.parse(s)}catch{}else L(s)?s=+s:s==="true"?s=!0:s==="false"&&(s=!1);n({...i,data:s})}else n(i)},r),this}removeEventListener(e,n,r){return this.off(e,n,r),this}close(){return this.ws.close(),this}};var ie=["get","post","put","delete","patch","options","head","connect","subscribe"],Z=["localhost","127.0.0.1","0.0.0.0"],J=typeof FileList>"u",oe=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,ce=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,fe=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,G=t=>J?t instanceof Blob:t instanceof FileList||t instanceof File,ye=t=>{if(!t)return!1;for(let e in t)if(G(t[e])||Array.isArray(t[e])&&t[e].find(G))return!0;return!1},D=t=>J?t:new Promise(e=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],t.name,{lastModified:t.lastModified,type:t.type});e(r)},n.readAsArrayBuffer(t)}),$=(t,e,n={},r={})=>{if(Array.isArray(t)){for(let i of t)if(!Array.isArray(i))r=$(i,e,n,r);else{let s=i[0];if(typeof s=="string")r[s.toLowerCase()]=i[1];else for(let[a,d]of s)r[a.toLowerCase()]=d}return r}if(!t)return r;switch(typeof t){case"function":let i=t(e,n);return i?$(i,e,n,r):r;case"object":if(t instanceof Headers)return t.forEach((s,a)=>{r[a.toLowerCase()]=s}),r;for(let[s,a]of Object.entries(t))r[s.toLowerCase()]=a;default:return r}},K=(t,e,n=[],r)=>new Proxy(()=>{},{get(i,s){return K(t,e,s==="index"?n:[...n,s],r)},apply(i,s,[a,d]){if(!a||d||typeof a=="object"&&Object.keys(a).length!==1||ie.includes(n.at(-1))){let W=[...n],v=W.pop(),g="/"+W.join("/"),{fetcher:u=fetch,headers:E,onRequest:p,onResponse:F,fetch:j}=e,A=v==="get"||v==="head"||v==="subscribe";E=$(E,g,d);let N=A?a?.query:d?.query,w="";if(N){let o=(O,k)=>{w+=(w?"&":"?")+`${encodeURIComponent(O)}=${encodeURIComponent(k)}`};for(let[O,k]of Object.entries(N)){if(Array.isArray(k)){for(let f of k)o(O,f);continue}o(O,`${k}`)}}if(v==="subscribe"){let o=t.replace(/^([^]+):\/\//,t.startsWith("https://")?"wss://":t.startsWith("http://")||Z.find(O=>t.includes(O))?"ws://":"wss://")+g+w;return new I(o)}return(async()=>{let o={method:v?.toUpperCase(),body:a,...j,headers:E};o.headers={...E,...$(A?a?.headers:d?.headers,g,o)};let O=A&&typeof a=="object"?a.fetch:d?.fetch;if(o={...o,...O},A&&delete o.body,p){Array.isArray(p)||(p=[p]);for(let y of p){let c=await y(g,o);typeof c=="object"&&(o={...o,...c,headers:{...o.headers,...$(c.headers,g,o)}})}}if(A&&delete o.body,ye(a)){let y=new FormData;for(let[c,h]of Object.entries(o.body)){if(J){y.append(c,h);continue}if(h instanceof File){y.append(c,await D(h));continue}if(h instanceof FileList){for(let l=0;l<h.length;l++)y.append(c,await D(h[l]));continue}if(Array.isArray(h)){for(let l=0;l<h.length;l++){let S=h[l];y.append(c,S instanceof File?await D(S):S)}continue}y.append(c,h)}}else typeof a=="object"?(o.headers["content-type"]="application/json",o.body=JSON.stringify(a)):a!=null&&(o.headers["content-type"]="text/plain");if(A&&delete o.body,p){Array.isArray(p)||(p=[p]);for(let y of p){let c=await y(g,o);typeof c=="object"&&(o={...o,...c,headers:{...o.headers,...c.headers}})}}let k=t+g+w,f=await(r?.handle(new Request(k,o))??u(k,o)),b=null,m=null;if(F){Array.isArray(F)||(F=[F]);for(let y of F)try{let c=await y(f.clone());if(c!=null){b=c;break}}catch(c){c instanceof T?m=c:m=new T(422,c);break}}if(b===null){switch(f.headers.get("Content-Type")?.split(";")[0]){case"application/json":b=await f.json();break;case"application/octet-stream":b=await f.arrayBuffer();break;default:b=await f.text().then(y=>{if(L(y))return+y;if(y==="true")return!0;if(y==="false")return!1;if(!y)return y;let c=y.replace(/"/g,"");if(oe.test(c)||ce.test(c)||fe.test(c)){let h=new Date(c);if(!Number.isNaN(h.getTime()))return h}return y})}(f.status>=300||f.status<200)&&(m=new T(f.status,b),b=null)}return{data:b,error:m,response:f,status:f.status,headers:f.headers}})()}return typeof a=="object"?K(t,e,[...n,Object.values(a)[0]],r):K(t,e,n)}}),V=(t,e={})=>typeof t=="string"?(e.keepDomain||(t.includes("://")||(t=(Z.find(n=>t.includes(n))?"http://":"https://")+t),t.endsWith("/")&&(t=t.slice(0,-1))),K(t,e)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),K("http://e.ly",e,[],t));var H=typeof FileList>"u",z=t=>H?t instanceof Blob:t instanceof FileList||t instanceof File,ue=t=>{if(!t)return!1;for(let e in t){if(z(t[e]))return!0;if(Array.isArray(t[e])&&t[e].find(n=>z(n)))return!0}return!1},U=t=>H?t:new Promise(e=>{let n=new FileReader;n.onload=()=>{let r=new File([n.result],t.name,{lastModified:t.lastModified,type:t.type});e(r)},n.readAsArrayBuffer(t)}),B=class{ws;url;constructor(e){this.ws=new WebSocket(e),this.url=e}send(e){return Array.isArray(e)?(e.forEach(n=>this.send(n)),this):(this.ws.send(typeof e=="object"?JSON.stringify(e):e.toString()),this)}on(e,n,r){return this.addEventListener(e,n,r)}off(e,n,r){return this.ws.removeEventListener(e,n,r),this}subscribe(e,n){return this.addEventListener("message",e,n)}addEventListener(e,n,r){return this.ws.addEventListener(e,i=>{if(e==="message"){let s=i.data.toString(),a=s.charCodeAt(0);if(a===47||a===123)try{s=JSON.parse(s)}catch{}else L(s)?s=+s:s==="true"?s=!0:s==="false"&&(s=!1);n({...i,data:s})}else n(i)},r),this}removeEventListener(e,n,r){return this.off(e,n,r),this}close(){return this.ws.close(),this}},Q=(t,e="",n)=>new Proxy(()=>{},{get(r,i,s){return Q(t,`${e}/${i.toString()}`,n)},apply(r,i,[s,a={}]=[{},{}]){let d=s!==void 0&&(typeof s!="object"||Array.isArray(s))?s:void 0,{$query:W,$fetch:v,$headers:g,$transform:u,getRaw:E,...p}=s??{};d??=p;let F=e.lastIndexOf("/"),j=e.slice(F+1).toUpperCase(),A=_(t,F===-1?"/":e.slice(0,F),Object.assign(a.query??{},W)),N=n.fetcher??fetch,w=n.transform?Array.isArray(n.transform)?n.transform:[n.transform]:void 0,o=u?Array.isArray(u)?u:[u]:void 0;return o&&(w?w=o.concat(w):w=o),j==="SUBSCRIBE"?new B(A.replace(/^([^]+):\/\//,A.startsWith("https://")?"wss://":"ws://")):(async k=>{let f,b={...n.$fetch?.headers,...v?.headers,...a.headers,...g};if(j!=="GET"&&j!=="HEAD"){f=Object.keys(d).length||Array.isArray(d)?d:void 0;let l=f&&(typeof f=="object"||Array.isArray(d));if(l&&ue(f)){let C=new FormData;for(let[M,x]of Object.entries(f))if(H)C.append(M,x);else if(x instanceof File)C.append(M,await U(x));else if(x instanceof FileList)for(let R=0;R<x.length;R++)C.append(M,await U(x[R]));else if(Array.isArray(x))for(let R=0;R<x.length;R++){let P=x[R];C.append(M,P instanceof File?await U(P):P)}else C.append(M,x);f=C}else f!=null&&(b["content-type"]=l?"application/json":"text/plain",f=l?JSON.stringify(f):d)}let m=await N(A,{method:j,body:f,...n.$fetch,...a.fetch,...v,headers:b}),y;if(k.getRaw)return m;switch(m.headers.get("Content-Type")?.split(";")[0]){case"application/json":y=await m.json();break;default:y=await m.text().then(l=>L(l)?+l:l==="true"?!0:l==="false"?!1:l)}let c=m.status>=300||m.status<200?new T(m.status,y):null,h={data:y,error:c,response:m,status:m.status,headers:m.headers};if(w)for(let l of w){let S=l(h);S instanceof Promise&&(S=await S),S!=null&&(h=S)}return h})({getRaw:E})}}),X=(t,e={fetcher:fetch})=>new Proxy({},{get(n,r){return Q(t,r,e)}});var Y=(t,e)=>(n,{query:r,params:i,body:s,...a}={})=>{i&&Object.entries(i).forEach(([u,E])=>{n=n.replace(`:${u}`,E)});let d=a.headers?.["Content-Type"];if(!d||d==="application/json")try{s=JSON.stringify(s)}catch{}let W=e?.fetcher||globalThis.fetch,v=r?`?${new URLSearchParams(r).toString()}`:"",g=()=>W(t+n+v,{...a,method:a.method?.toUpperCase()||"GET",headers:s?{"content-type":"application/json",...a.headers}:a.headers,body:s}).then(async u=>{let E;switch(u.headers.get("Content-Type")?.split(";")[0]){case"application/json":E=await u.json();break;default:E=await u.text().then(p=>L(p)?parseInt(p):p==="true"?!0:p==="false"?!1:p);break}return u.status>300?{data:null,status:u.status,headers:u.headers,retry:g,error:new T(u.status,E)}:{data:E,error:null,status:u.status,headers:u.headers,retry:g}});return g()};return ae(le);})();
