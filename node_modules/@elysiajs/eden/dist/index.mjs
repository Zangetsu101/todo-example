import{b as D}from"./chunk-FOFYS2DG.mjs";import{a as J}from"./chunk-TDCHXBL7.mjs";import{b as L,c as x}from"./chunk-HUZ6GXDC.mjs";var O=class{constructor(t){this.url=t;this.ws=new WebSocket(t)}ws;send(t){return Array.isArray(t)?(t.forEach(s=>this.send(s)),this):(this.ws.send(typeof t=="object"?JSON.stringify(t):t.toString()),this)}on(t,s,r){return this.addEventListener(t,s,r)}off(t,s,r){return this.ws.removeEventListener(t,s,r),this}subscribe(t,s){return this.addEventListener("message",t,s)}addEventListener(t,s,r){return this.ws.addEventListener(t,f=>{if(t==="message"){let o=f.data.toString(),a=o.charCodeAt(0);if(a===47||a===123)try{o=JSON.parse(o)}catch{}else L(o)?o=+o:o==="true"?o=!0:o==="false"&&(o=!1);s({...f,data:o})}else s(f)},r),this}removeEventListener(t,s,r){return this.off(t,s,r),this}close(){return this.ws.close(),this}};var P=["get","post","put","delete","patch","options","head","connect","subscribe"],N=["localhost","127.0.0.1","0.0.0.0"],M=typeof FileList>"u",U=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,_=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,$=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,K=e=>M?e instanceof Blob:e instanceof FileList||e instanceof File,B=e=>{if(!e)return!1;for(let t in e)if(K(e[t])||Array.isArray(e[t])&&e[t].find(K))return!0;return!1},R=e=>M?e:new Promise(t=>{let s=new FileReader;s.onload=()=>{let r=new File([s.result],e.name,{lastModified:e.lastModified,type:e.type});t(r)},s.readAsArrayBuffer(e)}),E=(e,t,s={},r={})=>{if(Array.isArray(e)){for(let f of e)if(!Array.isArray(f))r=E(f,t,s,r);else{let o=f[0];if(typeof o=="string")r[o.toLowerCase()]=f[1];else for(let[a,g]of o)r[a.toLowerCase()]=g}return r}if(!e)return r;switch(typeof e){case"function":let f=e(t,s);return f?E(f,t,s,r):r;case"object":if(e instanceof Headers)return e.forEach((o,a)=>{r[a.toLowerCase()]=o}),r;for(let[o,a]of Object.entries(e))r[o.toLowerCase()]=a;default:return r}},A=(e,t,s=[],r)=>new Proxy(()=>{},{get(f,o){return A(e,t,o==="index"?s:[...s,o],r)},apply(f,o,[a,g]){if(!a||g||typeof a=="object"&&Object.keys(a).length!==1||P.includes(s.at(-1))){let j=[...s],b=j.pop(),m="/"+j.join("/"),{fetcher:q=fetch,headers:k,onRequest:u,onResponse:S,fetch:I}=t,v=b==="get"||b==="head"||b==="subscribe";k=E(k,m,g);let C=v?a?.query:g?.query,F="";if(C){let n=(p,d)=>{F+=(F?"&":"?")+`${encodeURIComponent(p)}=${encodeURIComponent(d)}`};for(let[p,d]of Object.entries(C)){if(Array.isArray(d)){for(let y of d)n(p,y);continue}n(p,`${d}`)}}if(b==="subscribe"){let n=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||N.find(p=>e.includes(p))?"ws://":"wss://")+m+F;return new O(n)}return(async()=>{let n={method:b?.toUpperCase(),body:a,...I,headers:k};n.headers={...k,...E(v?a?.headers:g?.headers,m,n)};let p=v&&typeof a=="object"?a.fetch:g?.fetch;if(n={...n,...p},v&&delete n.body,u){Array.isArray(u)||(u=[u]);for(let c of u){let i=await c(m,n);typeof i=="object"&&(n={...n,...i,headers:{...n.headers,...E(i.headers,m,n)}})}}if(v&&delete n.body,B(a)){let c=new FormData;for(let[i,l]of Object.entries(n.body)){if(M){c.append(i,l);continue}if(l instanceof File){c.append(i,await R(l));continue}if(l instanceof FileList){for(let w=0;w<l.length;w++)c.append(i,await R(l[w]));continue}if(Array.isArray(l)){for(let w=0;w<l.length;w++){let W=l[w];c.append(i,W instanceof File?await R(W):W)}continue}c.append(i,l)}}else typeof a=="object"?(n.headers["content-type"]="application/json",n.body=JSON.stringify(a)):a!=null&&(n.headers["content-type"]="text/plain");if(v&&delete n.body,u){Array.isArray(u)||(u=[u]);for(let c of u){let i=await c(m,n);typeof i=="object"&&(n={...n,...i,headers:{...n.headers,...i.headers}})}}let d=e+m+F,y=await(r?.handle(new Request(d,n))??q(d,n)),h=null,T=null;if(S){Array.isArray(S)||(S=[S]);for(let c of S)try{let i=await c(y.clone());if(i!=null){h=i;break}}catch(i){i instanceof x?T=i:T=new x(422,i);break}}if(h===null){switch(y.headers.get("Content-Type")?.split(";")[0]){case"application/json":h=await y.json();break;case"application/octet-stream":h=await y.arrayBuffer();break;default:h=await y.text().then(c=>{if(L(c))return+c;if(c==="true")return!0;if(c==="false")return!1;if(!c)return c;let i=c.replace(/"/g,"");if(U.test(i)||_.test(i)||$.test(i)){let l=new Date(i);if(!Number.isNaN(l.getTime()))return l}return c})}(y.status>=300||y.status<200)&&(T=new x(y.status,h),h=null)}return{data:h,error:T,response:y,status:y.status,headers:y.headers}})()}return typeof a=="object"?A(e,t,[...s,Object.values(a)[0]],r):A(e,t,s)}}),H=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(N.find(s=>e.includes(s))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),A(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),A("http://e.ly",t,[],e));export{J as edenFetch,D as edenTreaty,H as treaty};
